<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pramiti AI - Enhanced Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #667eea;
            --primary-dark: #5a6fd8;
            --secondary-color: #764ba2;
            --background-color: #f8fafc;
            --surface-color: #ffffff;
            --text-primary: #2d3748;
            --text-secondary: #718096;
            --border-color: #e2e8f0;
            --success-color: #48bb78;
            --warning-color: #ed8936;
            --error-color: #f56565;
            --shadow-sm: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--background-color);
            color: var(--text-primary);
            line-height: 1.6;
        }

        .dashboard-container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 260px;
            background: linear-gradient(180deg, #1e293b 0%, #0f172a 100%);
            padding: 0;
            color: white;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 1000;
            transition: width 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border-right: 1px solid rgba(255, 255, 255, 0.1);
        }

        .sidebar.collapsed {
            width: 80px;
        }

        .sidebar-header {
            padding: 1.5rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            border-radius: 0.75rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            flex-shrink: 0;
        }

        .logo-text {
            transition: opacity 0.3s ease;
        }

        .sidebar.collapsed .logo-text {
            opacity: 0;
            width: 0;
            overflow: hidden;
        }

        .logo h1 {
            font-size: 1.25rem;
            font-weight: 700;
            margin: 0;
            white-space: nowrap;
        }

        .logo p {
            opacity: 0.7;
            font-size: 0.75rem;
            margin: 0;
            white-space: nowrap;
        }

        .sidebar-toggle {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 0.5rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            flex-shrink: 0;
        }

        .sidebar-toggle:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .sidebar.collapsed .sidebar-toggle i {
            transform: rotate(180deg);
        }

        .nav-menu {
            list-style: none;
            padding: 1rem 0.75rem;
        }

        .nav-item {
            margin-bottom: 0.25rem;
        }

        .nav-link {
            display: flex;
            align-items: center;
            padding: 0.875rem 1rem;
            color: rgba(255, 255, 255, 0.7);
            text-decoration: none;
            border-radius: 0.75rem;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .nav-link::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 3px;
            background: linear-gradient(180deg, var(--primary-color), var(--secondary-color));
            transform: scaleY(0);
            transition: transform 0.3s ease;
        }

        .nav-link:hover,
        .nav-link.active {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        .nav-link.active::before {
            transform: scaleY(1);
        }

        .nav-link i {
            width: 20px;
            margin-right: 1rem;
            flex-shrink: 0;
            text-align: center;
        }

        .sidebar.collapsed .nav-link {
            justify-content: center;
            padding: 0.875rem 0.5rem;
        }

        .sidebar.collapsed .nav-link i {
            margin-right: 0;
        }

        .nav-link-text {
            white-space: nowrap;
            transition: opacity 0.3s ease;
        }

        .sidebar.collapsed .nav-link-text {
            opacity: 0;
            width: 0;
            overflow: hidden;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: 260px;
            padding: 0;
            transition: margin-left 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            min-height: 100vh;
            background: var(--background-color);
        }

        .sidebar.collapsed ~ .main-content {
            margin-left: 80px;
        }

        .content-section,
        .tab-content {
            display: none;
        }

        .content-section.active,
        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Top Bar */
        .top-bar {
            background: white;
            border-bottom: 1px solid var(--border-color);
            padding: 1.25rem 2rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }

        .top-bar-left {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .breadcrumb {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        .breadcrumb-current {
            color: var(--text-primary);
            font-weight: 600;
        }

        .top-bar-actions {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        /* Content Wrapper */
        .content-wrapper {
            padding: 2rem;
            max-width: 100%;
        }

        /* Header */
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .page-title {
            font-size: 1.875rem;
            font-weight: 700;
            color: var(--text-primary);
            margin: 0;
        }

        .page-subtitle {
            color: var(--text-secondary);
            font-size: 0.95rem;
            margin-top: 0.25rem;
        }

        .dashboard-content {
            width: 100%;
            margin: 0;
            padding: 0;
        }

        /* Cards */
        .card {
            background: var(--surface-color);
            border-radius: 1.25rem;
            padding: 2rem;
            box-shadow: var(--shadow-sm);
            border: 2px solid var(--border-color);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .card:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-2px);
            border-color: var(--primary-color);
        }

        .card:hover::before {
            opacity: 1;
        }

        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--border-color);
        }

        .card-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
            margin: 0;
        }

        .card-content {
            color: var(--text-primary);
        }

        /* Dashboard Grid */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(min(100%, 500px), 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }

        @media (min-width: 1400px) {
            .dashboard-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 2rem;
            }
        }

        @media (min-width: 1800px) {
            .dashboard-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        /* Hierarchy Tree (Dashboard widget) */
        .hierarchy-tree {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .agent-node {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: var(--background-color);
            border-radius: 0.75rem;
            border: 2px solid var(--border-color);
            transition: all 0.3s ease;
        }

        .agent-node:hover {
            border-color: var(--primary-color);
            background: white;
            transform: translateX(4px);
        }

        .agent-node .agent-avatar {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            border-radius: 0.75rem;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.25rem;
            flex-shrink: 0;
            box-shadow: 0 2px 4px rgba(102, 126, 234, 0.3);
        }

        .agent-node .agent-info {
            flex: 1;
        }

        .agent-node .agent-name {
            font-weight: 600;
            font-size: 0.95rem;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }

        .agent-node .agent-role {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .agent-node .agent-status {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.75rem;
            font-weight: 600;
            margin-top: 0.25rem;
        }

        .agent-node .agent-status.online {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success-color);
        }

        .sme-agents {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        /* Activity Feed */
        .activity-feed {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .activity-item {
            display: flex;
            gap: 1rem;
            padding: 1rem;
            background: var(--background-color);
            border-radius: 0.75rem;
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
        }

        .activity-item:hover {
            background: white;
            border-color: var(--primary-color);
            transform: translateX(4px);
        }

        .activity-icon {
            width: 40px;
            height: 40px;
            border-radius: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1rem;
            flex-shrink: 0;
        }

        .activity-icon.system {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
        }

        .activity-icon.agent {
            background: linear-gradient(135deg, var(--success-color), #059669);
        }

        .activity-icon.warning {
            background: linear-gradient(135deg, var(--warning-color), #d97706);
        }

        .activity-content {
            flex: 1;
        }

        .activity-title {
            font-weight: 600;
            font-size: 0.95rem;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }

        .activity-description {
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
            line-height: 1.4;
        }

        .activity-time {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        @media (min-width: 1400px) {
            .stats-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        .stat-card {
            background: var(--surface-color);
            border-radius: 1.25rem;
            padding: 2rem;
            box-shadow: var(--shadow-sm);
            border: 2px solid var(--border-color);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
        }

        .stat-card:hover {
            border-color: var(--primary-color);
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .stat-content {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .stat-icon {
            width: 64px;
            height: 64px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            border-radius: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.75rem;
            flex-shrink: 0;
            box-shadow: 0 4px 6px rgba(102, 126, 234, 0.3);
        }

        .stat-details {
            flex: 1;
            text-align: left;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
            line-height: 1;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.875rem;
            font-weight: 500;
        }

        /* KPI Grid */
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        @media (min-width: 1600px) {
            .kpi-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        .kpi-card {
            background: var(--surface-color);
            border-radius: 1.25rem;
            padding: 2rem;
            box-shadow: var(--shadow-sm);
            border: 2px solid var(--border-color);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .kpi-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
        }

        .kpi-card:hover {
            border-color: var(--primary-color);
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .kpi-header {
            display: flex;
            align-items: flex-start;
            gap: 1.5rem;
        }

        .kpi-icon {
            width: 56px;
            height: 56px;
            border-radius: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
            flex-shrink: 0;
        }

        .kpi-icon.blue {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            box-shadow: 0 4px 6px rgba(59, 130, 246, 0.3);
        }

        .kpi-icon.green {
            background: linear-gradient(135deg, #10b981, #059669);
            box-shadow: 0 4px 6px rgba(16, 185, 129, 0.3);
        }

        .kpi-icon.purple {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            box-shadow: 0 4px 6px rgba(102, 126, 234, 0.3);
        }

        .kpi-icon.orange {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            box-shadow: 0 4px 6px rgba(245, 158, 11, 0.3);
        }

        .kpi-label {
            color: var(--text-secondary);
            font-size: 0.875rem;
            font-weight: 500;
            margin-bottom: 0.5rem;
        }

        .kpi-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-primary);
            line-height: 1;
            margin-bottom: 0.5rem;
        }

        .kpi-trend {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--success-color);
            font-size: 0.875rem;
        }

        .kpi-trend i {
            font-size: 0.75rem;
        }

        /* Section Headers */
        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--border-color);
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
            margin: 0;
        }

        .section-actions {
            display: flex;
            gap: 0.75rem;
        }

        /* Chat Interface - Modern Card-Based Design */
        .chat-container {
            display: grid;
            grid-template-columns: 320px 1fr;
            gap: 1.5rem;
            height: calc(100vh - 220px);
        }

        .chat-sidebar {
            background: var(--surface-color);
            border-radius: 1.25rem;
            border: 2px solid var(--border-color);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .agent-list {
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .agent-list-header {
            padding: 1.5rem;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .agent-list-header h4 {
            margin: 0;
            font-size: 1.125rem;
            font-weight: 600;
        }

        .agent-list-items {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
        }

        .chat-agent-item {
            padding: 1rem;
            border-radius: 0.75rem;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .chat-agent-item:hover {
            background: var(--background-color);
            border-color: var(--border-color);
        }

        .chat-agent-item.active {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
            border-color: var(--primary-color);
        }

        .chat-agent-item .agent-avatar.small {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            border-radius: 0.75rem;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.25rem;
            flex-shrink: 0;
            box-shadow: 0 2px 4px rgba(102, 126, 234, 0.3);
        }

        .chat-agent-item .agent-info {
            flex: 1;
        }

        .chat-agent-item .agent-name {
            font-weight: 600;
            font-size: 0.95rem;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }

        .chat-agent-item .agent-status {
            font-size: 0.8rem;
            color: var(--success-color);
        }

        .chat-main {
            background: var(--surface-color);
            border-radius: 1.25rem;
            border: 2px solid var(--border-color);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .chat-window {
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .chat-messages {
            flex: 1;
            padding: 1.5rem;
            overflow-y: auto;
            background: var(--background-color);
        }

        .chat-message {
            margin-bottom: 1.5rem;
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            animation: fadeIn 0.3s ease;
        }

        .chat-message.user {
            flex-direction: row-reverse;
        }

        .chat-message .message-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            flex-shrink: 0;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .chat-message.user .message-avatar {
            background: var(--primary-color);
            color: white;
        }

        .chat-message.agent .message-avatar,
        .chat-message.bot .message-avatar {
            background: var(--success-color);
            color: white;
        }

        .chat-message.system .message-avatar {
            background: var(--text-secondary);
            color: white;
        }

        .chat-message .message-content {
            background: white;
            padding: 1rem 1.25rem;
            border-radius: 1rem;
            max-width: 70%;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
        }

        .chat-message.user .message-content {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
            border-color: var(--primary-color);
        }

        .chat-message .message-text {
            font-size: 0.95rem;
            line-height: 1.6;
        }
        
        .chat-message .message-text p {
            margin: 0.5rem 0;
        }
        
        .chat-message .message-text p:first-child {
            margin-top: 0;
        }
        
        .chat-message .message-text p:last-child {
            margin-bottom: 0;
        }
        
        .chat-message .message-text ul,
        .chat-message .message-text ol {
            margin: 0.75rem 0;
            padding-left: 1.5rem;
        }
        
        .chat-message .message-text li {
            margin: 0.375rem 0;
            line-height: 1.5;
        }
        
        .chat-message .message-text strong {
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .chat-message .message-text em {
            font-style: italic;
        }
        
        .chat-message .message-text code {
            background: #f1f5f9;
            padding: 0.125rem 0.375rem;
            border-radius: 0.25rem;
            font-family: 'Courier New', monospace;
            font-size: 0.875em;
            color: #e11d48;
        }
        
        .chat-message .message-text .response-header {
            font-size: 1.1rem;
            font-weight: 600;
            margin: 1rem 0 0.5rem 0;
            color: var(--text-primary);
        }
        
        .chat-message .message-text h1.response-header {
            font-size: 1.25rem;
        }
        
        .chat-message .message-text h2.response-header {
            font-size: 1.15rem;
        }
        
        .chat-message .message-text h3.response-header {
            font-size: 1.1rem;
        }

        .chat-message .message-time {
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-top: 0.5rem;
        }
        
        .message-blockchain {
            margin-top: 0.5rem;
            font-size: 0.75rem;
            color: #10b981;
            font-weight: 500;
        }
        
        .typing-indicator .typing-dots {
            display: inline-flex;
            gap: 0.25rem;
        }
        
        .typing-indicator .typing-dots span {
            width: 8px;
            height: 8px;
            background: var(--text-secondary);
            border-radius: 50%;
            display: inline-block;
            animation: typing 1.4s infinite;
        }
        
        .typing-indicator .typing-dots span:nth-child(2) {
            animation-delay: 0.2s;
        }
        
        .typing-indicator .typing-dots span:nth-child(3) {
            animation-delay: 0.4s;
        }
        
        @keyframes typing {
            0%, 60%, 100% {
                transform: translateY(0);
                opacity: 0.7;
            }
            30% {
                transform: translateY(-10px);
                opacity: 1;
            }
        }

        .chat-input-area {
            padding: 1.5rem;
            background: var(--surface-color);
            border-top: 2px solid var(--border-color);
        }

        .chat-input-container {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .chat-input-container input {
            flex: 1;
            padding: 0.875rem 1.25rem;
            border: 2px solid var(--border-color);
            border-radius: 0.75rem;
            font-size: 0.95rem;
            transition: all 0.3s ease;
        }

        .chat-input-container input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .chat-input-container .btn {
            padding: 0.875rem 1.5rem;
        }

        .chat-options {
            margin-top: 1rem;
            display: flex;
            gap: 1rem;
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
            color: var(--text-secondary);
            cursor: pointer;
        }

        .checkbox-label input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .agent-item {
            padding: 1rem;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid transparent;
            margin-bottom: 0.5rem;
        }

        .agent-item:hover {
            background: var(--background-color);
        }

        .agent-item.active {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border-color: var(--primary-color);
        }

        .agent-info h4 {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .agent-info p {
            font-size: 0.875rem;
            opacity: 0.8;
        }

        .chat-window {
            background: var(--surface-color);
            border-radius: 1rem;
            display: flex;
            flex-direction: column;
            box-shadow: var(--shadow-sm);
            overflow: hidden;
        }

        .chat-header {
            padding: 1rem 1.5rem;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
        }

        .chat-messages {
            flex: 1;
            padding: 1rem;
            overflow-y: auto;
            background: #f9fafb;
        }

        .message {
            margin-bottom: 1rem;
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
        }

        .message.user {
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.875rem;
            font-weight: 600;
            flex-shrink: 0;
        }

        .message.user .message-avatar {
            background: var(--primary-color);
            color: white;
        }

        .message.agent .message-avatar {
            background: var(--success-color);
            color: white;
        }

        .message-content {
            background: white;
            padding: 1rem;
            border-radius: 1rem;
            max-width: 70%;
            box-shadow: var(--shadow-sm);
        }

        .message.user .message-content {
            background: var(--primary-color);
            color: white;
        }

        .message-time {
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-top: 0.5rem;
        }

        .chat-input {
            padding: 1rem 1.5rem;
            background: var(--surface-color);
            border-top: 1px solid var(--border-color);
        }

        .chat-input-form {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .chat-input-field {
            flex: 1;
            padding: 0.75rem 1rem;
            border: 1px solid var(--border-color);
            border-radius: 2rem;
            font-size: 0.875rem;
            outline: none;
            transition: border-color 0.3s ease;
        }

        .chat-input-field:focus {
            border-color: var(--primary-color);
        }

        .chat-send-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 2rem;
            cursor: pointer;
            transition: background 0.3s ease;
            font-weight: 600;
        }

        .chat-send-btn:hover {
            background: var(--primary-dark);
        }

        /* Agent Management */
        .agents-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(min(100%, 350px), 1fr));
            gap: 1.5rem;
            width: 100%;
        }

        @media (min-width: 1600px) {
            .agents-grid {
                grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
                gap: 2rem;
            }
        }

        @media (min-width: 2000px) {
            .agents-grid {
                grid-template-columns: repeat(auto-fill, minmax(420px, 1fr));
            }
        }

        .agent-card {
            background: var(--surface-color);
            border-radius: 1.25rem;
            padding: 2rem;
            box-shadow: var(--shadow-sm);
            border: 2px solid var(--border-color);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .agent-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .agent-card:hover {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.1);
            transform: translateY(-4px);
            border-color: var(--primary-color);
        }

        .agent-card:hover::before {
            opacity: 1;
        }

        .agent-header {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
        }

        .agent-avatar {
            width: 64px;
            height: 64px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
            margin-right: 1rem;
            box-shadow: 0 4px 6px rgba(102, 126, 234, 0.3);
        }

        .agent-name {
            font-weight: 600;
            font-size: 1.125rem;
        }

        .agent-role {
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        .agent-status {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.75rem;
            font-weight: 600;
            margin-top: 1rem;
        }

        .agent-status.online {
            background: #d4edda;
            color: var(--success-color);
        }

        .agent-status.offline {
            background: #f8d7da;
            color: var(--error-color);
        }

        /* Roles Grid - Matching Agent Grid */
        .roles-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(min(100%, 350px), 1fr));
            gap: 1.5rem;
            width: 100%;
        }

        @media (min-width: 1600px) {
            .roles-grid {
                grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
                gap: 2rem;
            }
        }

        @media (min-width: 2000px) {
            .roles-grid {
                grid-template-columns: repeat(auto-fill, minmax(420px, 1fr));
            }
        }

        .role-card {
            background: var(--surface-color);
            border-radius: 1.25rem;
            padding: 2rem;
            box-shadow: var(--shadow-sm);
            border: 2px solid var(--border-color);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .role-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #10b981, #059669);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .role-card:hover {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.1);
            transform: translateY(-4px);
            border-color: #10b981;
        }

        .role-card:hover::before {
            opacity: 1;
        }

        .role-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
        }

        .role-icon {
            width: 64px;
            height: 64px;
            background: linear-gradient(135deg, #10b981, #059669);
            border-radius: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
            box-shadow: 0 4px 6px rgba(16, 185, 129, 0.3);
        }

        .role-name {
            font-weight: 600;
            font-size: 1.125rem;
            margin-bottom: 0.5rem;
        }

        .role-description {
            color: var(--text-secondary);
            font-size: 0.875rem;
            line-height: 1.5;
            margin-bottom: 1rem;
        }

        .role-status {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .role-status.enabled {
            background: #d4edda;
            color: var(--success-color);
        }

        .role-status.disabled {
            background: #f8d7da;
            color: var(--error-color);
        }

        /* Blockchain Stats */
        .blockchain-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .stat-card {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            border-radius: 1rem;
            padding: 1.5rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            color: white;
            box-shadow: var(--shadow-md);
        }
        
        .stat-card i {
            font-size: 2.5rem;
            opacity: 0.9;
        }
        
        .stat-info {
            flex: 1;
        }
        
        .stat-value {
            font-size: 1.75rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
        }
        
        .stat-label {
            font-size: 0.875rem;
            opacity: 0.9;
        }
        
        .block-number {
            font-weight: 600;
            color: var(--primary-color);
            font-size: 1.1rem;
        }
        
        .block-number i {
            margin-right: 0.5rem;
        }
        
        .block-time {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }
        
        .blockchain-body {
            margin: 1rem 0;
        }
        
        .block-field {
            margin: 0.75rem 0;
            font-size: 0.9rem;
        }
        
        .block-field strong {
            color: var(--text-primary);
            margin-right: 0.5rem;
        }
        
        .agent-id {
            color: var(--primary-color);
            font-weight: 500;
        }
        
        .message-type {
            background: #e0e7ff;
            color: #4f46e5;
            padding: 0.25rem 0.5rem;
            border-radius: 0.375rem;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .message-preview {
            background: var(--background-color);
            padding: 0.75rem;
            border-radius: 0.5rem;
            margin-top: 0.75rem;
        }
        
        .blockchain-footer {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border-color);
        }
        
        .blockchain-footer .blockchain-hash {
            flex: 1;
            min-width: 200px;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .blockchain-footer .blockchain-hash i {
            font-size: 0.875rem;
        }

        /* Blockchain List View (Mailbox Style) */
        .blockchain-list {
            background: var(--surface-color);
            border-radius: 1rem;
            border: 2px solid var(--border-color);
            overflow: hidden;
        }

        .blockchain-item {
            border-bottom: 1px solid var(--border-color);
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .blockchain-item:last-child {
            border-bottom: none;
        }

        .blockchain-item:hover {
            background: var(--background-color);
        }

        .blockchain-item.expanded {
            background: var(--background-color);
        }

        .blockchain-item-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem 1.5rem;
            user-select: none;
        }

        .blockchain-item-indicator {
            width: 4px;
            height: 48px;
            border-radius: 2px;
            flex-shrink: 0;
        }

        .blockchain-item-indicator.request {
            background: linear-gradient(180deg, #3b82f6, #2563eb);
        }

        .blockchain-item-indicator.response {
            background: linear-gradient(180deg, #10b981, #059669);
        }

        .blockchain-item-indicator.system {
            background: linear-gradient(180deg, #6366f1, #4f46e5);
        }

        .blockchain-item-icon {
            width: 48px;
            height: 48px;
            border-radius: 0.75rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            flex-shrink: 0;
            background: var(--background-color);
            border: 2px solid var(--border-color);
        }

        .blockchain-item-icon.request {
            color: #3b82f6;
            border-color: #3b82f6;
            background: #eff6ff;
        }

        .blockchain-item-icon.response {
            color: #10b981;
            border-color: #10b981;
            background: #f0fdf4;
        }

        .blockchain-item-icon.system {
            color: #6366f1;
            border-color: #6366f1;
            background: #eef2ff;
        }

        .blockchain-item-info {
            flex: 1;
            min-width: 0;
        }

        .blockchain-item-title {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 0.25rem;
        }

        .blockchain-item-agents {
            font-weight: 600;
            font-size: 0.95rem;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .blockchain-item-agents .arrow {
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        .blockchain-item-type {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.625rem;
            border-radius: 0.375rem;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.025em;
        }

        .blockchain-item-type.request {
            background: #dbeafe;
            color: #1e40af;
        }

        .blockchain-item-type.response {
            background: #d1fae5;
            color: #065f46;
        }

        .blockchain-item-type.system {
            background: #e0e7ff;
            color: #3730a3;
        }

        .blockchain-item-preview {
            color: var(--text-secondary);
            font-size: 0.875rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .blockchain-item-meta {
            display: flex;
            align-items: center;
            gap: 1.5rem;
            flex-shrink: 0;
        }

        .blockchain-item-block {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        .blockchain-item-block i {
            color: var(--primary-color);
        }

        .blockchain-item-time {
            color: var(--text-secondary);
            font-size: 0.875rem;
            white-space: nowrap;
        }

        .blockchain-item-expand {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 0.5rem;
            color: var(--text-secondary);
            transition: all 0.2s ease;
            flex-shrink: 0;
        }

        .blockchain-item-expand:hover {
            background: var(--border-color);
            color: var(--text-primary);
        }

        .blockchain-item-expand i {
            transition: transform 0.2s ease;
        }

        .blockchain-item.expanded .blockchain-item-expand i {
            transform: rotate(180deg);
        }

        .blockchain-item-details {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .blockchain-item.expanded .blockchain-item-details {
            max-height: 500px;
        }

        .blockchain-item-body {
            padding: 0 1.5rem 1.5rem 1.5rem;
            margin-left: 68px; /* Align with content above */
        }

        .blockchain-detail-row {
            display: flex;
            gap: 2rem;
            margin-bottom: 1rem;
        }

        .blockchain-detail-field {
            flex: 1;
        }

        .blockchain-detail-label {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.375rem;
        }

        .blockchain-detail-value {
            font-size: 0.9rem;
            color: var(--text-primary);
        }

        .blockchain-detail-value.hash {
            font-family: 'Courier New', monospace;
            font-size: 0.75rem;
            color: var(--primary-color);
            background: var(--background-color);
            padding: 0.5rem;
            border-radius: 0.375rem;
            word-break: break-all;
        }

        .blockchain-detail-message {
            background: var(--background-color);
            padding: 1rem;
            border-radius: 0.5rem;
            border-left: 3px solid var(--primary-color);
            margin-top: 1rem;
        }

        .blockchain-detail-message-label {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.5rem;
        }

        .blockchain-detail-message-text {
            font-size: 0.9rem;
            color: var(--text-primary);
            line-height: 1.5;
        }

        /* Analytics Grid */
        .analytics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(min(100%, 350px), 1fr));
            gap: 1.5rem;
            width: 100%;
        }

        @media (min-width: 1400px) {
            .analytics-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (min-width: 1800px) {
            .analytics-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        .analytics-card {
            background: var(--surface-color);
            border-radius: 1.25rem;
            padding: 2rem;
            box-shadow: var(--shadow-sm);
            border: 2px solid var(--border-color);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .analytics-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #f59e0b, #d97706);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .analytics-card:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-2px);
            border-color: #f59e0b;
        }

        .analytics-card:hover::before {
            opacity: 1;
        }

        .analytics-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .analytics-icon {
            width: 56px;
            height: 56px;
            background: linear-gradient(135deg, #f59e0b, #d97706);
            border-radius: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
            box-shadow: 0 4px 6px rgba(245, 158, 11, 0.3);
        }

        .analytics-title {
            font-weight: 600;
            font-size: 1.125rem;
        }

        .analytics-subtitle {
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        /* Tab Content Containers - Consistent Styling */
        .agents-management,
        .roles-management,
        .hierarchy-builder,
        .blockchain-logs,
        .analytics-dashboard,
        .settings-panel {
            width: 100%;
        }

        .agents-management .page-header,
        .hierarchy-builder .page-header {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 2px solid var(--border-color);
        }

        .header-content h2 {
            font-size: 1.875rem;
            font-weight: 700;
            color: var(--text-primary);
            margin: 0 0 0.5rem 0;
        }

        .header-content p {
            color: var(--text-secondary);
            font-size: 0.95rem;
            margin: 0;
        }

        .header-actions {
            display: flex;
            gap: 0.75rem;
            align-items: center;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            color: var(--text-secondary);
        }

        .empty-state i {
            font-size: 4rem;
            margin-bottom: 1.5rem;
            opacity: 0.3;
        }

        .empty-state h3 {
            font-size: 1.25rem;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        .empty-state p {
            font-size: 0.95rem;
            margin-bottom: 1.5rem;
        }

        /* Card Actions - Consistent Button Layout */
        .agent-card-actions,
        .role-card-actions,
        .card-actions {
            display: flex;
            gap: 0.75rem;
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--border-color);
        }

        .agent-card-actions .btn,
        .role-card-actions .btn,
        .card-actions .btn {
            flex: 1;
            justify-content: center;
        }

        .btn-sm {
            padding: 0.625rem 1.25rem;
            font-size: 0.875rem;
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--border-color);
            color: var(--text-primary);
        }

        .btn-outline:hover {
            background: var(--background-color);
            border-color: var(--primary-color);
            color: var(--primary-color);
        }

        /* Buttons */
        .btn {
            padding: 0.875rem 1.75rem;
            border: none;
            border-radius: 0.75rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            text-align: center;
            font-size: 0.95rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
            color: white;
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, var(--primary-dark) 0%, var(--secondary-color) 100%);
            box-shadow: 0 6px 16px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, var(--text-secondary) 0%, #5a6578 100%);
            color: white;
        }

        .btn-secondary:hover {
            box-shadow: 0 6px 16px rgba(113, 128, 150, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success-color) 0%, #38a169 100%);
            color: white;
        }

        .btn-success:hover {
            box-shadow: 0 6px 16px rgba(72, 187, 120, 0.4);
        }

        .btn-warning {
            background: linear-gradient(135deg, var(--warning-color) 0%, #dd6b20 100%);
            color: white;
        }

        .btn-warning:hover {
            box-shadow: 0 6px 16px rgba(237, 137, 54, 0.4);
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--error-color) 0%, #e53e3e 100%);
            color: white;
        }

        .btn-danger:hover {
            box-shadow: 0 6px 16px rgba(245, 101, 101, 0.4);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        /* User Bot Interface */
        /* User Chatbot - Modern Full-Width Design */
        .userbot-container {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 1.5rem;
            height: calc(100vh - 220px);
        }

        .userbot-chat {
            background: var(--surface-color);
            border-radius: 1.25rem;
            border: 2px solid var(--border-color);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .userbot-sidebar {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .conversation-history,
        .active-tickets {
            background: var(--surface-color);
            border-radius: 1.25rem;
            border: 2px solid var(--border-color);
            padding: 1.5rem;
        }

        .conversation-history h4,
        .active-tickets h4 {
            margin: 0 0 1rem 0;
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .history-items,
        .ticket-items {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .history-item,
        .ticket-item {
            padding: 0.875rem;
            background: var(--background-color);
            border-radius: 0.75rem;
            border: 1px solid var(--border-color);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .history-item:hover,
        .ticket-item:hover {
            border-color: var(--primary-color);
            background: white;
        }

        .history-title,
        .ticket-id {
            font-weight: 600;
            font-size: 0.875rem;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }

        .history-time {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        .ticket-status {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.75rem;
            font-weight: 600;
            margin-top: 0.5rem;
        }

        .ticket-status.in-progress {
            background: rgba(237, 137, 54, 0.1);
            color: var(--warning-color);
        }

        .ticket-status.completed {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success-color);
        }

        .quick-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--border-color);
        }

        .quick-action-btn {
            padding: 0.75rem 1.25rem;
            background: var(--background-color);
            border: 2px solid var(--border-color);
            border-radius: 0.75rem;
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .quick-action-btn:hover {
            background: white;
            border-color: var(--primary-color);
            color: var(--primary-color);
        }

        .quick-action-btn i {
            font-size: 1rem;
        }

        /* Hierarchy Builder - Modern Card-Based Design */
        .hierarchy-canvas {
            background: var(--surface-color);
            border-radius: 1.25rem;
            border: 2px solid var(--border-color);
            padding: 2rem;
            min-height: 500px;
        }

        .hierarchy-builder-container {
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }

        .hierarchy-level {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .level-label {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .agent-slots {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            padding: 1rem;
            background: var(--background-color);
            border-radius: 1rem;
            border: 2px dashed var(--border-color);
        }

        .agent-slot {
            flex: 0 0 auto;
            min-width: 200px;
            background: white;
            border: 2px solid var(--border-color);
            border-radius: 1rem;
            padding: 1.25rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .agent-slot.occupied {
            border-color: var(--primary-color);
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.05), rgba(118, 75, 162, 0.05));
        }

        .agent-slot.empty {
            border-style: dashed;
            border-color: var(--border-light);
        }

        .agent-slot.empty:hover {
            border-color: var(--primary-color);
            border-style: solid;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.05), rgba(118, 75, 162, 0.05));
        }

        .agent-slot:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .slot-content {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-weight: 500;
            color: var(--text-primary);
        }

        .slot-content i {
            font-size: 1.5rem;
            color: var(--primary-color);
        }

        .agent-slot.empty .slot-content {
            color: var(--text-secondary);
        }

        .agent-slot.empty .slot-content i {
            color: var(--text-secondary);
        }

        .userbot-intro {
            text-align: center;
            margin-bottom: 2rem;
        }

        .userbot-intro h2 {
            font-size: 2rem;
            margin-bottom: 1rem;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .quick-action {
            background: var(--surface-color);
            border: 1px solid var(--border-color);
            border-radius: 0.75rem;
            padding: 1rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .quick-action:hover {
            border-color: var(--primary-color);
            background: var(--background-color);
        }

        .quick-action i {
            font-size: 2rem;
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
                position: static;
                height: auto;
            }

            .main-content {
                margin-left: 0;
                padding: 1rem;
            }

            .chat-container {
                grid-template-columns: 1fr;
                height: auto;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Loading States */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid var(--border-color);
            border-radius: 50%;
            border-top-color: var(--primary-color);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Notifications */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--surface-color);
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            padding: 1rem;
            box-shadow: var(--shadow-lg);
            z-index: 9999;
            max-width: 350px;
        }

        .notification.success {
            border-left: 4px solid var(--success-color);
        }

        .notification.error {
            border-left: 4px solid var(--error-color);
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Sidebar Navigation -->
        <nav class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <div class="logo-icon">
                        <i class="fas fa-robot"></i>
                    </div>
                    <div class="logo-text">
                        <h1>Agentic AI</h1>
                        <p>Organization System</p>
                    </div>
                </div>
                <button class="sidebar-toggle" onclick="toggleSidebar()">
                    <i class="fas fa-chevron-left"></i>
                </button>
            </div>
            
            <ul class="nav-menu">
                <li class="nav-item active">
                    <a href="#dashboard" class="nav-link active" data-tab="dashboard">
                        <i class="fas fa-chart-line"></i>
                        <span class="nav-link-text">Dashboard</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#organizations" class="nav-link" data-tab="organizations">
                        <i class="fas fa-building"></i>
                        <span class="nav-link-text">Organizations</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#agents" class="nav-link" data-tab="agents">
                        <i class="fas fa-users"></i>
                        <span class="nav-link-text">Agent Management</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#hierarchy" class="nav-link" data-tab="hierarchy">
                        <i class="fas fa-sitemap"></i>
                        <span class="nav-link-text">Hierarchy Builder</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#chat" class="nav-link" data-tab="chat">
                        <i class="fas fa-comments"></i>
                        <span class="nav-link-text">Agent Chat</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#userbot" class="nav-link" data-tab="userbot">
                        <i class="fas fa-robot"></i>
                        <span class="nav-link-text">User Chatbot</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#blockchain" class="nav-link" data-tab="blockchain">
                        <i class="fas fa-link"></i>
                        <span class="nav-link-text">Blockchain Logs</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#tickets" class="nav-link" data-tab="tickets">
                        <i class="fas fa-ticket-alt"></i>
                        <span class="nav-link-text">Tickets</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#archives" class="nav-link" data-tab="archives">
                        <i class="fas fa-archive"></i>
                        <span class="nav-link-text">Data Archives</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#analytics" class="nav-link" data-tab="analytics">
                        <i class="fas fa-chart-bar"></i>
                        <span class="nav-link-text">Analytics</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#roles" class="nav-link" data-tab="roles">
                        <i class="fas fa-user-tag"></i>
                        <span class="nav-link-text">Roles</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#settings" class="nav-link" data-tab="settings">
                        <i class="fas fa-cog"></i>
                        <span class="nav-link-text">Settings</span>
                    </a>
                </li>
            </ul>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Top Bar -->
            <div class="top-bar">
                <div class="top-bar-left">
                    <h1 class="page-title" id="page-title">Organization Dashboard</h1>
                </div>
                
                <div class="top-bar-actions">
                    <div class="system-status">
                        <div class="status-indicator healthy">
                            <div class="status-dot"></div>
                            <span id="system-health">Healthy</span>
                        </div>
                    </div>
                    
                    <button class="btn btn-primary" data-action="refresh-data">
                        <i class="fas fa-sync"></i>
                        Refresh
                    </button>
                </div>
            </div>

            <!-- Content Area -->
            <div class="content-wrapper">
                <!-- Dashboard Content -->
                <div id="dashboard-content" class="tab-content active">
                    <div class="dashboard-content">
                        <!-- KPI Cards -->
                        <div class="kpi-grid">
                            <div class="kpi-card">
                                <div class="kpi-header">
                                    <div class="kpi-icon blue">
                                        <i class="fas fa-users"></i>
                                    </div>
                                    <div>
                                        <div class="kpi-label">Active Agents</div>
                                        <div class="kpi-value" data-kpi="active-agents">6</div>
                                        <div class="kpi-trend">
                                            <i class="fas fa-arrow-up"></i>
                                            <span>+2 today</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="kpi-card">
                                <div class="kpi-header">
                                    <div class="kpi-icon green">
                                        <i class="fas fa-envelope"></i>
                                    </div>
                                    <div>
                                        <div class="kpi-label">Messages Today</div>
                                        <div class="kpi-value" data-kpi="total-messages">1,247</div>
                                        <div class="kpi-trend">
                                            <i class="fas fa-arrow-up"></i>
                                            <span>+23 from yesterday</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="kpi-card">
                                <div class="kpi-header">
                                    <div class="kpi-icon orange">
                                        <i class="fas fa-clock"></i>
                                    </div>
                                    <div>
                                        <div class="kpi-label">Avg Response Time</div>
                                        <div class="kpi-value" data-kpi="avg-response-time">1.2s</div>
                                        <div class="kpi-trend">
                                            <i class="fas fa-arrow-down"></i>
                                            <span>-0.3s improvement</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="kpi-card">
                                <div class="kpi-header">
                                    <div class="kpi-icon purple">
                                        <i class="fas fa-server"></i>
                                    </div>
                                    <div>
                                        <div class="kpi-label">System Uptime</div>
                                        <div class="kpi-value" data-kpi="system-uptime">99.9%</div>
                                        <div class="kpi-trend">
                                            <i class="fas fa-arrow-up"></i>
                                            <span>+0.1% improvement</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Main Dashboard Grid -->
                        <div class="dashboard-grid">
                            <!-- Organization Hierarchy -->
                            <div class="card">
                                <div class="card-header">
                                    <h3 class="card-title">Organization Hierarchy</h3>
                                </div>
                                <div class="card-content">
                                    <div class="hierarchy-tree">
                                        <!-- CEO Level -->
                                        <div class="hierarchy-level">
                                            <div class="agent-node ceo" data-agent-id="ceo">
                                                <div class="agent-avatar">
                                                    <i class="fas fa-crown"></i>
                                                </div>
                                                <div class="agent-info">
                                                    <div class="agent-name">CEO Agent</div>
                                                    <div class="agent-role">Executive</div>
                                                    <div class="agent-status online">Online</div>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- Manager Level -->
                                        <div class="hierarchy-level">
                                            <div class="agent-node manager" data-agent-id="senior_manager">
                                                <div class="agent-avatar">
                                                    <i class="fas fa-user-tie"></i>
                                                </div>
                                                <div class="agent-info">
                                                    <div class="agent-name">Senior Manager</div>
                                                    <div class="agent-role">Management</div>
                                                    <div class="agent-status online">Online</div>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- SME Level -->
                                        <div class="hierarchy-level">
                                            <div class="sme-agents">
                                                <div class="agent-node sme" data-agent-id="incident_agent">
                                                    <div class="agent-avatar">
                                                        <i class="fas fa-exclamation-triangle"></i>
                                                    </div>
                                                    <div class="agent-info">
                                                        <div class="agent-name">Incident Mgmt</div>
                                                        <div class="agent-role">ITSM Expert</div>
                                                        <div class="agent-status online">Online</div>
                                                    </div>
                                                </div>
                                                
                                                <div class="agent-node sme" data-agent-id="problem_agent">
                                                    <div class="agent-avatar">
                                                        <i class="fas fa-search"></i>
                                                    </div>
                                                    <div class="agent-info">
                                                        <div class="agent-name">Problem Mgmt</div>
                                                        <div class="agent-role">ITSM Expert</div>
                                                        <div class="agent-status online">Online</div>
                                                    </div>
                                                </div>
                                                
                                                <div class="agent-node sme" data-agent-id="change_agent">
                                                    <div class="agent-avatar">
                                                        <i class="fas fa-cogs"></i>
                                                    </div>
                                                    <div class="agent-info">
                                                        <div class="agent-name">Change Mgmt</div>
                                                        <div class="agent-role">ITSM Expert</div>
                                                        <div class="agent-status online">Online</div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Activity Feed -->
                            <div class="card">
                                <div class="card-header">
                                    <h3 class="card-title">Recent Activity</h3>
                                </div>
                                <div class="card-content">
                                    <div class="activity-feed">
                                        <div class="activity-item">
                                            <div class="activity-icon system">
                                                <i class="fas fa-plus"></i>
                                            </div>
                                            <div class="activity-content">
                                                <div class="activity-title">New agent created</div>
                                                <div class="activity-description">Change Management Agent was added to the organization</div>
                                                <div class="activity-time">5 minutes ago</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Cost Optimization Analytics -->
                            <div class="card" style="grid-column: 1 / -1;">
                                <div class="card-header">
                                    <h3 class="card-title">
                                        <i class="fas fa-chart-line"></i>
                                        Cost Optimization Analytics
                                    </h3>
                                    <span class="badge badge-professional">Hybrid SLM/LLM Routing</span>
                                </div>
                                <div class="card-content">
                                    <!-- Cost Overview Cards -->
                                    <div class="cost-overview-grid">
                                        <div class="cost-stat-card">
                                            <div class="cost-stat-icon blue">
                                                <i class="fas fa-robot"></i>
                                            </div>
                                            <div class="cost-stat-content">
                                                <div class="cost-stat-label">SLM Queries</div>
                                                <div class="cost-stat-value" id="dashboard-slm-queries">0</div>
                                                <div class="cost-stat-subtitle" id="dashboard-slm-percentage">0% of total</div>
                                            </div>
                                        </div>
                                        <div class="cost-stat-card">
                                            <div class="cost-stat-icon purple">
                                                <i class="fas fa-brain"></i>
                                            </div>
                                            <div class="cost-stat-content">
                                                <div class="cost-stat-label">LLM Queries</div>
                                                <div class="cost-stat-value" id="dashboard-llm-queries">0</div>
                                                <div class="cost-stat-subtitle" id="dashboard-llm-percentage">0% of total</div>
                                            </div>
                                        </div>
                                        <div class="cost-stat-card">
                                            <div class="cost-stat-icon green">
                                                <i class="fas fa-piggy-bank"></i>
                                            </div>
                                            <div class="cost-stat-content">
                                                <div class="cost-stat-label">Cost Savings</div>
                                                <div class="cost-stat-value" id="dashboard-cost-savings">$0.00</div>
                                                <div class="cost-stat-subtitle" id="dashboard-savings-percentage">0% saved</div>
                                            </div>
                                        </div>
                                        <div class="cost-stat-card">
                                            <div class="cost-stat-icon orange">
                                                <i class="fas fa-dollar-sign"></i>
                                            </div>
                                            <div class="cost-stat-content">
                                                <div class="cost-stat-label">Total Cost</div>
                                                <div class="cost-stat-value" id="dashboard-total-cost">$0.00</div>
                                                <div class="cost-stat-subtitle">This month</div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Model Distribution Chart -->
                                    <div class="model-distribution">
                                        <h4>Model Usage Distribution</h4>
                                        <div class="distribution-bars">
                                            <div class="distribution-row">
                                                <div class="distribution-label">
                                                    <i class="fas fa-robot"></i>
                                                    <span>SLM (Small Language Model)</span>
                                                </div>
                                                <div class="distribution-bar">
                                                    <div class="distribution-fill slm" id="dashboard-slm-bar" style="width: 0%">
                                                        <span class="distribution-value">0%</span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="distribution-row">
                                                <div class="distribution-label">
                                                    <i class="fas fa-brain"></i>
                                                    <span>LLM (Large Language Model)</span>
                                                </div>
                                                <div class="distribution-bar">
                                                    <div class="distribution-fill llm" id="dashboard-llm-bar" style="width: 0%">
                                                        <span class="distribution-value">0%</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="cost-insights">
                                            <div class="insight-item">
                                                <i class="fas fa-lightbulb"></i>
                                                <span>SLM queries are ~15x more cost-effective than LLM queries</span>
                                            </div>
                                            <div class="insight-item">
                                                <i class="fas fa-check-circle"></i>
                                                <span>Intelligent routing automatically selects the optimal model for each query</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Organizations Content -->
                <div id="organizations-content" class="tab-content">
                    <div class="organizations-management">
                        <div class="page-header">
                            <div class="header-content">
                                <h2>Multi-Tenant Organizations</h2>
                                <p>Manage tenant organizations with isolated data and cost optimization</p>
                            </div>
                            <div class="header-actions">
                                <button class="btn btn-primary" data-modal="create-organization-modal">
                                    <i class="fas fa-plus"></i>
                                    Create Organization
                                </button>
                                <button class="btn btn-secondary" onclick="refreshOrganizations()">
                                    <i class="fas fa-sync-alt"></i>
                                    Refresh
                                </button>
                            </div>
                        </div>

                        <!-- Organization Stats -->
                        <div class="kpi-grid" style="margin-bottom: 2rem;">
                            <div class="kpi-card">
                                <div class="kpi-header">
                                    <div class="kpi-icon blue">
                                        <i class="fas fa-building"></i>
                                    </div>
                                    <div>
                                        <div class="kpi-label">Total Organizations</div>
                                        <div class="kpi-value" id="total-organizations">0</div>
                                    </div>
                                </div>
                            </div>
                            <div class="kpi-card">
                                <div class="kpi-header">
                                    <div class="kpi-icon green">
                                        <i class="fas fa-chart-line"></i>
                                    </div>
                                    <div>
                                        <div class="kpi-label">Total Queries</div>
                                        <div class="kpi-value" id="total-queries-all">0</div>
                                    </div>
                                </div>
                            </div>
                            <div class="kpi-card">
                                <div class="kpi-header">
                                    <div class="kpi-icon purple">
                                        <i class="fas fa-dollar-sign"></i>
                                    </div>
                                    <div>
                                        <div class="kpi-label">Total Cost</div>
                                        <div class="kpi-value" id="total-cost-all">$0.00</div>
                                    </div>
                                </div>
                            </div>
                            <div class="kpi-card">
                                <div class="kpi-header">
                                    <div class="kpi-icon orange">
                                        <i class="fas fa-piggy-bank"></i>
                                    </div>
                                    <div>
                                        <div class="kpi-label">Avg SLM Usage</div>
                                        <div class="kpi-value" id="avg-slm-usage">0%</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Organizations List -->
                        <div class="organizations-list">
                            <div class="list-header">
                                <h3>Organizations</h3>
                                <div class="search-bar">
                                    <i class="fas fa-search"></i>
                                    <input type="text" id="org-search" placeholder="Search organizations...">
                                </div>
                            </div>
                            <div id="organizations-container">
                                <!-- Organizations will be loaded here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Agent Management Content -->
                <div id="agents-content" class="tab-content">
                    <div class="agents-management">
                        <div class="page-header">
                            <div class="header-content">
                                <h2>Agent Management</h2>
                                <p>Create, edit, and manage your AI agents</p>
                            </div>
                            <div class="header-actions">
                                <button class="btn btn-primary" data-modal="add-agent-modal">
                                    <i class="fas fa-plus"></i>
                                    Add Agent
                                </button>
                            </div>
                        </div>

                        <div class="agents-grid">
                            <!-- Agents will be dynamically loaded here -->
                            <div class="agent-card" data-agent-id="ceo">
                                <div class="agent-card-header">
                                    <div class="agent-avatar large">
                                        <i class="fas fa-crown"></i>
                                    </div>
                                    <div class="agent-badge ceo">CEO</div>
                                </div>
                                <div class="agent-card-content">
                                    <h4>CEO Agent</h4>
                                    <p class="agent-type">Executive Leader</p>
                                    <div class="agent-responsibilities">
                                        <div class="responsibility-tag">Strategic Planning</div>
                                        <div class="responsibility-tag">Decision Making</div>
                                        <div class="responsibility-tag">Oversight</div>
                                    </div>
                                </div>
                                <div class="agent-card-actions">
                                    <button class="btn btn-sm btn-outline" data-action="edit-agent" data-agent-id="ceo">
                                        <i class="fas fa-edit"></i>
                                        Edit
                                    </button>
                                    <button class="btn btn-sm btn-primary" data-action="chat-agent" data-agent-id="ceo">
                                        <i class="fas fa-comment"></i>
                                        Chat
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Hierarchy Builder Content -->
                <div id="hierarchy-content" class="tab-content">
                    <div class="hierarchy-builder">
                        <div class="page-header">
                            <div class="header-content">
                                <h2>Hierarchy Builder</h2>
                                <p>Design and configure your organization structure</p>
                            </div>
                            <div class="header-actions">
                                <button class="btn btn-outline" data-action="reset-hierarchy">
                                    <i class="fas fa-undo"></i>
                                    Reset
                                </button>
                                <button class="btn btn-primary" data-action="save-hierarchy">
                                    <i class="fas fa-save"></i>
                                    Save Changes
                                </button>
                            </div>
                        </div>

                        <div class="hierarchy-canvas">
                            <div class="hierarchy-builder-container">
                                <!-- Dynamic hierarchy builder will be rendered here -->
                                <div class="hierarchy-level" data-level="0">
                                    <div class="level-label">Executive Level</div>
                                    <div class="agent-slots">
                                        <div class="agent-slot occupied" data-agent-id="ceo">
                                            <div class="slot-content">
                                                <i class="fas fa-crown"></i>
                                                <span>CEO Agent</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="hierarchy-level" data-level="1">
                                    <div class="level-label">Management Level</div>
                                    <div class="agent-slots">
                                        <div class="agent-slot occupied" data-agent-id="senior_manager">
                                            <div class="slot-content">
                                                <i class="fas fa-user-tie"></i>
                                                <span>Senior Manager</span>
                                            </div>
                                        </div>
                                        <div class="agent-slot empty">
                                            <div class="slot-content">
                                                <i class="fas fa-plus"></i>
                                                <span>Add Manager</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="hierarchy-level" data-level="2">
                                    <div class="level-label">Specialist Level</div>
                                    <div class="agent-slots">
                                        <div class="agent-slot occupied" data-agent-id="incident_agent">
                                            <div class="slot-content">
                                                <i class="fas fa-exclamation-triangle"></i>
                                                <span>Incident Mgmt</span>
                                            </div>
                                        </div>
                                        <div class="agent-slot occupied" data-agent-id="problem_agent">
                                            <div class="slot-content">
                                                <i class="fas fa-search"></i>
                                                <span>Problem Mgmt</span>
                                            </div>
                                        </div>
                                        <div class="agent-slot occupied" data-agent-id="change_agent">
                                            <div class="slot-content">
                                                <i class="fas fa-cogs"></i>
                                                <span>Change Mgmt</span>
                                            </div>
                                        </div>
                                        <div class="agent-slot empty">
                                            <div class="slot-content">
                                                <i class="fas fa-plus"></i>
                                                <span>Add Specialist</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Agent Chat Content -->
                <div id="chat-content" class="tab-content">
                    <div class="chat-interface">
                        <div class="chat-header">
                            <div class="header-content">
                                <h2>Agent Chat Interface</h2>
                                <p>Test and interact with your agents</p>
                            </div>
                        </div>

                        <div class="chat-container">
                            <div class="chat-sidebar">
                                <div class="agent-list">
                                    <div class="agent-list-header">
                                        <h4>Available Agents</h4>
                                    </div>
                                    <div class="agent-list-items">
                                        <div class="chat-agent-item active" data-agent-id="ceo-001">
                                            <div class="agent-avatar small">
                                                <i class="fas fa-crown"></i>
                                            </div>
                                            <div class="agent-info">
                                                <div class="agent-name">Executive AI Director</div>
                                                <div class="agent-status">Online</div>
                                            </div>
                                        </div>
                                        <div class="chat-agent-item" data-agent-id="manager-incident-001">
                                            <div class="agent-avatar small">
                                                <i class="fas fa-user-tie"></i>
                                            </div>
                                            <div class="agent-info">
                                                <div class="agent-name">ITSM Operations Manager</div>
                                                <div class="agent-status">Online</div>
                                            </div>
                                        </div>
                                        <div class="chat-agent-item" data-agent-id="agent-incident-001">
                                            <div class="agent-avatar small">
                                                <i class="fas fa-exclamation-triangle"></i>
                                            </div>
                                            <div class="agent-info">
                                                <div class="agent-name">Incident Response Specialist</div>
                                                <div class="agent-status">Online</div>
                                            </div>
                                        </div>
                                        <div class="chat-agent-item" data-agent-id="agent-problem-001">
                                            <div class="agent-avatar small">
                                                <i class="fas fa-search"></i>
                                            </div>
                                            <div class="agent-info">
                                                <div class="agent-name">Problem Analysis Expert</div>
                                                <div class="agent-status">Online</div>
                                            </div>
                                        </div>
                                        <div class="chat-agent-item" data-agent-id="agent-change-001">
                                            <div class="agent-avatar small">
                                                <i class="fas fa-exchange-alt"></i>
                                            </div>
                                            <div class="agent-info">
                                                <div class="agent-name">Change Management Specialist</div>
                                                <div class="agent-status">Online</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="chat-main">
                                <div class="chat-window">
                                    <div class="chat-messages" id="agent-chat-messages">
                                        <div class="chat-message system">
                                            <div class="message-content">
                                                <div class="message-text">Select an agent from the sidebar to start chatting</div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="chat-input-area">
                                        <div class="chat-input-container">
                                            <input type="text" id="agent-chat-input" placeholder="Type your message to the agent..." />
                                            <button class="btn btn-primary" id="send-agent-message">
                                                <i class="fas fa-paper-plane"></i>
                                            </button>
                                        </div>
                                        <div class="chat-options">
                                            <label class="checkbox-label">
                                                <input type="checkbox" id="save-to-blockchain" checked>
                                                <span class="checkmark"></span>
                                                Save to blockchain
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- User Chatbot Content -->
                <div id="userbot-content" class="tab-content">
                    <div class="userbot-interface">
                        <div class="userbot-header">
                            <div class="header-content">
                                <h2>Organization Assistant</h2>
                                <p>Chat with the AI organization to get help with your requests</p>
                            </div>
                        </div>

                        <div class="userbot-container">
                            <div class="userbot-chat">
                                <div class="chat-messages" id="userbot-messages">
                                    <div class="chat-message bot">
                                        <div class="message-avatar">
                                            <i class="fas fa-robot"></i>
                                        </div>
                                        <div class="message-content">
                                            <div class="message-text">
                                                Hello! I'm your AI Organization Assistant. I can help you with:
                                                <ul>
                                                    <li> Create and manage service requests</li>
                                                    <li> Report incidents and issues</li>
                                                    <li> Submit change requests</li>
                                                    <li> Answer questions about services</li>
                                                    <li> Get status updates</li>
                                                </ul>
                                                What can I help you with today?
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="chat-input-area">
                                    <div class="quick-actions">
                                        <button class="quick-action-btn" data-action="report-incident">
                                            <i class="fas fa-exclamation-triangle"></i>
                                            Report Incident
                                        </button>
                                        <button class="quick-action-btn" data-action="service-request">
                                            <i class="fas fa-ticket-alt"></i>
                                            Service Request
                                        </button>
                                        <button class="quick-action-btn" data-action="check-status">
                                            <i class="fas fa-info-circle"></i>
                                            Check Status
                                        </button>
                                        <button class="quick-action-btn" data-action="ask-question">
                                            <i class="fas fa-question-circle"></i>
                                            Ask Question
                                        </button>
                                    </div>

                                    <div class="chat-input-container">
                                        <input type="text" id="userbot-input" placeholder="Describe your request or ask a question..." />
                                        <button class="btn btn-primary" id="send-userbot-message">
                                            <i class="fas fa-paper-plane"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <div class="userbot-sidebar">
                                <div class="conversation-history">
                                    <h4>Conversation History</h4>
                                    <div class="history-items">
                                        <div class="history-item">
                                            <div class="history-title">Incident Report - Server Down</div>
                                            <div class="history-time">2 hours ago</div>
                                        </div>
                                        <div class="history-item">
                                            <div class="history-title">Service Request - New User</div>
                                            <div class="history-time">1 day ago</div>
                                        </div>
                                    </div>
                                </div>

                                <div class="active-tickets">
                                    <h4>Active Tickets</h4>
                                    <div class="ticket-items">
                                        <div class="ticket-item">
                                            <div class="ticket-id">INC-2024-001</div>
                                            <div class="ticket-status in-progress">In Progress</div>
                                        </div>
                                        <div class="ticket-item">
                                            <div class="ticket-id">REQ-2024-005</div>
                                            <div class="ticket-status completed">Completed</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Other tab contents (blockchain, analytics, settings) -->
                <div id="blockchain-content" class="tab-content">
                    <div class="blockchain-logs">
                        <div class="section-header">
                            <div>
                                <h2>Blockchain Communication Logs</h2>
                                <p>Immutable audit trail of all agent communications</p>
                            </div>
                            <button class="btn btn-primary" onclick="loadBlockchainLogs()">
                                <i class="fas fa-sync-alt"></i>
                                Refresh
                            </button>
                        </div>
                        
                        <div class="blockchain-stats">
                            <div class="stat-card">
                                <i class="fas fa-cubes"></i>
                                <div class="stat-info">
                                    <div class="stat-value" id="total-blocks">0</div>
                                    <div class="stat-label">Total Blocks</div>
                                </div>
                            </div>
                            <div class="stat-card">
                                <i class="fas fa-check-circle"></i>
                                <div class="stat-info">
                                    <div class="stat-value" id="chain-valid">Valid</div>
                                    <div class="stat-label">Chain Status</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="blockchain-list">
                            <!-- Blockchain logs will be loaded here as a list -->
                            <div class="empty-state">
                                <i class="fas fa-link"></i>
                                <p>No blockchain logs yet</p>
                                <small>Start chatting with agents to create blockchain entries</small>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tickets Management Content -->
                <div id="tickets-content" class="tab-content">
                    <div class="tickets-management">
                        <div class="section-header">
                            <div>
                                <h2>Ticket Management</h2>
                                <p>Track and manage support tickets across the organization</p>
                            </div>
                            <button class="btn btn-primary" onclick="showCreateTicketModal()">
                                <i class="fas fa-plus"></i>
                                Create Ticket
                            </button>
                        </div>

                        <!-- Ticket Stats -->
                        <div class="ticket-stats">
                            <div class="stat-card stat-active">
                                <div class="stat-icon">
                                    <i class="fas fa-hourglass-half"></i>
                                </div>
                                <div class="stat-info">
                                    <div class="stat-label">Active</div>
                                    <div class="stat-value" id="active-tickets-count">0</div>
                                </div>
                            </div>
                            <div class="stat-card stat-progress">
                                <div class="stat-icon">
                                    <i class="fas fa-spinner"></i>
                                </div>
                                <div class="stat-info">
                                    <div class="stat-label">In Progress</div>
                                    <div class="stat-value" id="progress-tickets-count">0</div>
                                </div>
                            </div>
                            <div class="stat-card stat-resolved">
                                <div class="stat-icon">
                                    <i class="fas fa-check-circle"></i>
                                </div>
                                <div class="stat-info">
                                    <div class="stat-label">Resolved</div>
                                    <div class="stat-value" id="resolved-tickets-count">0</div>
                                </div>
                            </div>
                            <div class="stat-card stat-inactive">
                                <div class="stat-icon">
                                    <i class="fas fa-pause-circle"></i>
                                </div>
                                <div class="stat-info">
                                    <div class="stat-label">Inactive</div>
                                    <div class="stat-value" id="inactive-tickets-count">0</div>
                                </div>
                            </div>
                        </div>

                        <!-- Ticket Filters -->
                        <div class="ticket-filters">
                            <div class="filter-group">
                                <label>Status:</label>
                                <select id="ticket-status-filter" onchange="filterTickets()">
                                    <option value="all">All Statuses</option>
                                    <option value="active">Active</option>
                                    <option value="in_progress">In Progress</option>
                                    <option value="resolved">Resolved</option>
                                    <option value="inactive">Inactive</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label>Priority:</label>
                                <select id="ticket-priority-filter" onchange="filterTickets()">
                                    <option value="all">All Priorities</option>
                                    <option value="critical">Critical</option>
                                    <option value="high">High</option>
                                    <option value="medium">Medium</option>
                                    <option value="low">Low</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label>Search:</label>
                                <input type="text" id="ticket-search" placeholder="Search tickets..." oninput="filterTickets()">
                            </div>
                        </div>

                        <!-- Tickets List -->
                        <div class="tickets-list">
                            <!-- Tickets will be dynamically loaded here -->
                            <div class="empty-state">
                                <i class="fas fa-ticket-alt"></i>
                                <p>No tickets yet</p>
                                <small>Create your first ticket to get started</small>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Data Archives Content -->
                <div id="archives-content" class="tab-content">
                    <div class="archives-management">
                        <div class="section-header">
                            <div>
                                <h2>Data Archives</h2>
                                <p>Upload and manage organization documents, guidelines, and policies</p>
                            </div>
                            <button class="btn btn-primary" onclick="showUploadDocumentModal()">
                                <i class="fas fa-upload"></i>
                                Upload Document
                            </button>
                        </div>

                        <!-- Archive Statistics -->
                        <div class="archive-stats">
                            <div class="stat-card">
                                <div class="stat-icon" style="background: #eff6ff; color: #3b82f6;">
                                    <i class="fas fa-file-alt"></i>
                                </div>
                                <div class="stat-info">
                                    <div class="stat-label">Total Documents</div>
                                    <div class="stat-value" id="total-documents-count">0</div>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon" style="background: #f0fdf4; color: #10b981;">
                                    <i class="fas fa-book"></i>
                                </div>
                                <div class="stat-info">
                                    <div class="stat-label">Guidelines</div>
                                    <div class="stat-value" id="guidelines-count">0</div>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon" style="background: #fef3c7; color: #f59e0b;">
                                    <i class="fas fa-file-contract"></i>
                                </div>
                                <div class="stat-info">
                                    <div class="stat-label">Policies</div>
                                    <div class="stat-value" id="policies-count">0</div>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon" style="background: #fce7f3; color: #ec4899;">
                                    <i class="fas fa-database"></i>
                                </div>
                                <div class="stat-info">
                                    <div class="stat-label">Total Size</div>
                                    <div class="stat-value" id="total-size">0 MB</div>
                                </div>
                            </div>
                        </div>

                        <!-- Document Filters -->
                        <div class="archive-filters">
                            <div class="filter-group">
                                <label>Category:</label>
                                <select id="archive-category-filter" onchange="filterArchives()">
                                    <option value="all">All Categories</option>
                                    <option value="guidelines">Guidelines</option>
                                    <option value="policies">Policies</option>
                                    <option value="procedures">Procedures</option>
                                    <option value="templates">Templates</option>
                                    <option value="reference">Reference</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label>File Type:</label>
                                <select id="archive-type-filter" onchange="filterArchives()">
                                    <option value="all">All Types</option>
                                    <option value="pdf">PDF</option>
                                    <option value="docx">DOCX</option>
                                    <option value="txt">TXT</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label>Search:</label>
                                <input type="text" id="archive-search" placeholder="Search documents..." oninput="filterArchives()">
                            </div>
                        </div>

                        <!-- Documents List -->
                        <div class="archives-list">
                            <!-- Documents will be dynamically loaded here -->
                            <div class="empty-state">
                                <i class="fas fa-archive"></i>
                                <p>No documents yet</p>
                                <small>Upload your first document to get started</small>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="analytics-content" class="tab-content">
                    <div class="analytics-dashboard">
                        <h2>Analytics & Reports</h2>
                        <p>Performance metrics and insights</p>
                    </div>
                </div>

                <div id="roles-content" class="tab-content">
                    <div class="roles-management">
                        <div class="section-header">
                            <div>
                                <h2>Role Management</h2>
                                <p>Define and manage organizational roles with custom permissions</p>
                            </div>
                            <button class="btn btn-primary" onclick="showCreateRoleModal()">
                                <i class="fas fa-plus"></i>
                                Create Role
                            </button>
                        </div>

                        <div class="roles-grid">
                            <!-- Roles will be dynamically loaded here -->
                        </div>
                    </div>
                </div>

                <div id="settings-content" class="tab-content">
                    <div class="settings-panel">
                        <h2>System Settings</h2>
                        <p>Configure your AI organization</p>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modals -->
    <!-- Create Organization Modal -->
    <div class="modal-overlay" id="create-organization-modal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Create New Organization</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-content">
                <form id="create-organization-form">
                    <div class="form-grid">
                        <div class="form-group full-width">
                            <label for="org-name">Organization Name *</label>
                            <input type="text" id="org-name" name="organization_name" required placeholder="e.g., Acme Corporation">
                        </div>
                        
                        <div class="form-group">
                            <label for="org-admin-name">Admin Name *</label>
                            <input type="text" id="org-admin-name" name="admin_name" required placeholder="e.g., John Doe">
                        </div>

                        <div class="form-group">
                            <label for="org-admin-email">Admin Email *</label>
                            <input type="email" id="org-admin-email" name="admin_email" required placeholder="admin@example.com">
                        </div>

                        <div class="form-group">
                            <label for="org-industry">Industry *</label>
                            <select id="org-industry" name="industry" required>
                                <option value="general">General</option>
                                <option value="finance">Finance</option>
                                <option value="healthcare">Healthcare</option>
                                <option value="tech">Technology</option>
                                <option value="retail">Retail</option>
                                <option value="manufacturing">Manufacturing</option>
                                <option value="education">Education</option>
                            </select>
                            <small class="form-help">Finance & Healthcare prefer quality, Tech prefers cost optimization</small>
                        </div>

                        <div class="form-group">
                            <label for="org-size">Organization Size *</label>
                            <select id="org-size" name="size" required>
                                <option value="small">Small (1-50)</option>
                                <option value="medium">Medium (51-500)</option>
                                <option value="large">Large (501-5000)</option>
                                <option value="enterprise">Enterprise (5000+)</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="org-tier">Subscription Tier *</label>
                            <select id="org-tier" name="subscription_tier" required>
                                <option value="basic">Basic - $50-100/mo (10 agents, 100 tickets/mo)</option>
                                <option value="professional" selected>Professional - $300-600/mo (50 agents, 1K tickets/mo)</option>
                                <option value="enterprise">Enterprise - $2K-4K/mo (500 agents, 10K tickets/mo)</option>
                            </select>
                            <small class="form-help">Higher tiers unlock more resources and features</small>
                        </div>
                    </div>

                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary modal-close">Cancel</button>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-building"></i>
                            Create Organization
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Add Agent Modal -->
    <div class="modal-overlay" id="add-agent-modal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Add New Agent</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-content">
                <form id="add-agent-form" enctype="multipart/form-data">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="agent-name">Agent Name *</label>
                            <input type="text" id="agent-name" name="name" required placeholder="e.g., Security Specialist">
                        </div>
                        
                        <div class="form-group">
                            <label for="agent-type">Agent Type *</label>
                            <input type="text" id="agent-type" name="agent_type" required placeholder="e.g., Security, ITSM, Analytics">
                        </div>

                        <div class="form-group full-width">
                            <label for="agent-role">Reportee Role (Own Role) *</label>
                            <select id="agent-role" name="role" required>
                                <option value="">Select role...</option>
                                <!-- Will be populated dynamically from backend -->
                            </select>
                            <small class="form-help">The hierarchical role of this agent</small>
                        </div>

                        <div class="form-group full-width">
                            <label for="agent-reporting-manager">Reporting Manager Role *</label>
                            <select id="agent-reporting-manager" name="reporting_manager_role" required>
                                <option value="">Select reporting manager role...</option>
                                <!-- Will be populated dynamically based on selected reportee role -->
                            </select>
                            <small class="form-help">The role this agent reports to (must be higher in hierarchy)</small>
                        </div>

                        <div class="form-group full-width">
                            <label for="agent-reports-to">Reports To (Specific Agent)</label>
                            <select id="agent-reports-to" name="reports_to_agent_id">
                                <option value="">Select a specific manager (optional)...</option>
                                <!-- Will be populated with agents matching the reporting manager role -->
                            </select>
                            <small class="form-help">Choose a specific agent this agent will report to. This creates direct reporting relationships for escalations and approvals.</small>
                        </div>

                        <div class="form-group full-width">
                            <label for="agent-specialization">Specialization *</label>
                            <input type="text" id="agent-specialization" name="specialization" required placeholder="e.g., Cybersecurity and Threat Analysis">
                            <small class="form-help">Specific area of expertise within the role</small>
                        </div>

                        <div class="form-group full-width">
                            <label for="agent-model">AI Model</label>
                            <select id="agent-model" name="model">
                                <option value="gpt-4o-mini">GPT-4o Mini (Fast & Cost-Effective)</option>
                                <option value="gpt-4o">GPT-4o (More Powerful)</option>
                            </select>
                        </div>

                        <div class="form-group full-width">
                            <label for="agent-responsibilities-doc">
                                <i class="fas fa-file-word"></i>
                                Responsibilities Document (Optional)
                            </label>
                            <input type="file" id="agent-responsibilities-doc" name="responsibilities_doc" accept=".docx,.doc,.pdf,.txt">
                            <small class="form-help">Upload a DOCX file containing detailed responsibilities and job description. This will enhance the agent's capabilities and be added to its system prompt.</small>
                            <div id="doc-preview" style="display: none; margin-top: 0.5rem; padding: 0.75rem; background: #f0fdf4; border: 1px solid #86efac; border-radius: 0.5rem;">
                                <i class="fas fa-check-circle" style="color: #10b981;"></i>
                                <span id="doc-filename" style="margin-left: 0.5rem; color: #059669; font-weight: 500;"></span>
                                <button type="button" id="remove-doc" style="margin-left: 1rem; color: #dc2626; background: none; border: none; cursor: pointer;">
                                    <i class="fas fa-times"></i> Remove
                                </button>
                            </div>
                        </div>
                        
                        <div class="form-info">
                            <i class="fas fa-info-circle"></i>
                            <span>Base responsibilities are defined by the role. Upload a document to customize and extend them for this specific agent. The reporting hierarchy helps build the organization structure.</span>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn btn-outline modal-close">Cancel</button>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-plus"></i>
                            Create Agent
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Create/Edit Role Modal -->
    <div class="modal-overlay" id="role-modal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title" id="role-modal-title">Create New Role</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-content">
                <form id="role-form">
                    <input type="hidden" id="role-id" name="role_id">
                    <input type="hidden" id="role-edit-mode" value="false">
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="role-name">Role Name *</label>
                            <input type="text" id="role-name" name="name" required placeholder="e.g., Technical Lead">
                        </div>
                        
                        <div class="form-group">
                            <label for="role-level">Hierarchy Level *</label>
                            <select id="role-level" name="level" required>
                                <option value="">Select level...</option>
                                <option value="1">Level 1 - Executive (CEO)</option>
                                <option value="2">Level 2 - Senior Management</option>
                                <option value="3">Level 3 - Management</option>
                                <option value="4">Level 4 - Specialist</option>
                                <option value="5">Level 5 - Analyst</option>
                                <option value="6">Level 6 - Operator</option>
                            </select>
                        </div>

                        <div class="form-group full-width">
                            <label for="role-description">Description *</label>
                            <textarea id="role-description" name="description" rows="2" required placeholder="Describe the role's purpose"></textarea>
                        </div>

                        <div class="form-group full-width">
                            <label for="role-responsibilities">Responsibilities *</label>
                            <textarea id="role-responsibilities" name="responsibilities" rows="4" required placeholder="- Lead strategic initiatives&#10;- Manage team operations&#10;- Approve major decisions"></textarea>
                            <small class="form-help">Define default responsibilities for agents with this role</small>
                        </div>

                        <div class="form-group full-width">
                            <label for="role-permissions">Permissions</label>
                            <div class="permissions-grid">
                                <label class="permission-item">
                                    <input type="checkbox" name="permissions" value="create_agents">
                                    <span>Create Agents</span>
                                </label>
                                <label class="permission-item">
                                    <input type="checkbox" name="permissions" value="manage_agents">
                                    <span>Manage Agents</span>
                                </label>
                                <label class="permission-item">
                                    <input type="checkbox" name="permissions" value="view_analytics">
                                    <span>View Analytics</span>
                                </label>
                                <label class="permission-item">
                                    <input type="checkbox" name="permissions" value="escalate_issues">
                                    <span>Escalate Issues</span>
                                </label>
                                <label class="permission-item">
                                    <input type="checkbox" name="permissions" value="approve_decisions">
                                    <span>Approve Decisions</span>
                                </label>
                                <label class="permission-item">
                                    <input type="checkbox" name="permissions" value="execute_tasks">
                                    <span>Execute Tasks</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn btn-outline modal-close">Cancel</button>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i>
                            <span id="role-submit-text">Create Role</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Edit Agent Modal -->
    <div class="modal-overlay" id="edit-agent-modal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Edit Agent</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-content">
                <form id="edit-agent-form">
                    <input type="hidden" id="edit-agent-id">
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="edit-agent-name">Agent Name *</label>
                            <input type="text" id="edit-agent-name" name="name" required placeholder="e.g., Security Specialist">
                        </div>
                        
                        <div class="form-group">
                            <label for="edit-agent-type">Agent Type *</label>
                            <input type="text" id="edit-agent-type" name="agent_type" required placeholder="e.g., Security, ITSM, Analytics">
                        </div>

                        <div class="form-group full-width">
                            <label for="edit-agent-role">Hierarchical Role *</label>
                            <select id="edit-agent-role" name="role" required>
                                <!-- Will be populated dynamically from roles -->
                            </select>
                        </div>

                        <div class="form-group full-width">
                            <label for="edit-agent-specialization">Specialization *</label>
                            <input type="text" id="edit-agent-specialization" name="specialization" required placeholder="e.g., Cybersecurity and Threat Analysis">
                            <small class="form-help">Specific area of expertise within the role</small>
                        </div>

                        <div class="form-group full-width">
                            <label for="edit-agent-model">AI Model</label>
                            <select id="edit-agent-model" name="model">
                                <option value="gpt-4o-mini">GPT-4o Mini (Fast & Cost-Effective)</option>
                                <option value="gpt-4o">GPT-4o (More Powerful)</option>
                            </select>
                        </div>
                        
                        <div class="form-info">
                            <i class="fas fa-info-circle"></i>
                            <span>Responsibilities are defined by the role and cannot be customized per agent. To modify responsibilities, edit the role in the Roles tab.</span>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn btn-outline modal-close">Cancel</button>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i>
                            Update Agent
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Create Ticket Modal -->
    <div class="modal-overlay" id="create-ticket-modal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Create New Ticket</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-content">
                <form id="create-ticket-form">
                    <div class="form-grid">
                        <div class="form-group full-width">
                            <label for="ticket-title">Title *</label>
                            <input type="text" id="ticket-title" name="title" required placeholder="Brief description of the issue">
                        </div>

                        <div class="form-group full-width">
                            <label for="ticket-description">Description *</label>
                            <textarea id="ticket-description" name="description" rows="4" required placeholder="Detailed description of the ticket"></textarea>
                        </div>

                        <div class="form-group">
                            <label for="ticket-priority">Priority *</label>
                            <select id="ticket-priority" name="priority" required>
                                <option value="">Select Priority</option>
                                <option value="low">Low</option>
                                <option value="medium" selected>Medium</option>
                                <option value="high">High</option>
                                <option value="critical">Critical</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="ticket-status">Status *</label>
                            <select id="ticket-status" name="status" required>
                                <option value="active" selected>Active</option>
                                <option value="in_progress">In Progress</option>
                                <option value="resolved">Resolved</option>
                                <option value="inactive">Inactive</option>
                            </select>
                        </div>

                        <div class="form-group full-width">
                            <label for="ticket-assigned-to">Assign To</label>
                            <select id="ticket-assigned-to" name="assigned_to">
                                <option value="">Unassigned</option>
                                <!-- Will be populated with agents -->
                            </select>
                        </div>

                        <div class="form-group full-width">
                            <label for="ticket-category">Category</label>
                            <input type="text" id="ticket-category" name="category" placeholder="e.g., Bug, Feature Request, Support">
                        </div>

                        <div class="form-group full-width">
                            <label for="ticket-tags">Tags</label>
                            <input type="text" id="ticket-tags" name="tags" placeholder="Comma-separated tags (e.g., urgent, security, backend)">
                            <small class="form-help">Separate multiple tags with commas</small>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn btn-outline modal-close">Cancel</button>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-plus"></i>
                            Create Ticket
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Upload Document Modal -->
    <div class="modal-overlay" id="upload-document-modal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Upload Document</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-content">
                <form id="upload-document-form" enctype="multipart/form-data">
                    <div class="form-grid">
                        <div class="form-group full-width">
                            <label for="document-title">Document Title *</label>
                            <input type="text" id="document-title" name="title" required placeholder="e.g., Employee Handbook, IT Security Policy">
                        </div>

                        <div class="form-group full-width">
                            <label for="document-description">Description</label>
                            <textarea id="document-description" name="description" rows="3" placeholder="Brief description of the document contents"></textarea>
                        </div>

                        <div class="form-group">
                            <label for="document-category">Category *</label>
                            <select id="document-category" name="category" required>
                                <option value="">Select Category</option>
                                <option value="guidelines">Guidelines</option>
                                <option value="policies">Policies</option>
                                <option value="procedures">Procedures</option>
                                <option value="templates">Templates</option>
                                <option value="reference">Reference</option>
                                <option value="other">Other</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="document-department">Department</label>
                            <input type="text" id="document-department" name="department" placeholder="e.g., IT, HR, Finance">
                        </div>

                        <div class="form-group full-width">
                            <label for="document-file">Document File *</label>
                            <input type="file" id="document-file" name="file" required accept=".pdf,.docx,.txt">
                            <small class="form-help">Supported formats: PDF, DOCX, TXT (Max 10MB)</small>
                        </div>

                        <div class="form-group full-width">
                            <label for="document-tags">Tags</label>
                            <input type="text" id="document-tags" name="tags" placeholder="Comma-separated tags (e.g., security, compliance, onboarding)">
                            <small class="form-help">Separate multiple tags with commas</small>
                        </div>

                        <div class="form-group full-width">
                            <label class="checkbox-label">
                                <input type="checkbox" id="document-searchable" name="searchable" checked>
                                <span>Make this document searchable by agents</span>
                            </label>
                            <small class="form-help">When enabled, agents can use this document to answer user queries</small>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn btn-outline modal-close">Cancel</button>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-upload"></i>
                            Upload Document
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div class="toast-container" id="toast-container"></div>

    <!-- Scripts -->
    <script>
        // Configuration - Automatically detect API URL based on current location
        const API_BASE_URL = `${window.location.protocol}//${window.location.hostname}:${window.location.port || '8084'}`;
        
        // Sidebar Toggle Function
        function toggleSidebar() {
            const sidebar = document.querySelector('.sidebar');
            sidebar.classList.toggle('collapsed');
            
            // Save state to localStorage
            const isCollapsed = sidebar.classList.contains('collapsed');
            localStorage.setItem('sidebarCollapsed', isCollapsed);
        }
        
        // Initialize the dashboard
        document.addEventListener('DOMContentLoaded', function() {
            console.log(' Enhanced Dashboard initializing...');
            
            try {
                // Restore sidebar state
                const sidebarCollapsed = localStorage.getItem('sidebarCollapsed') === 'true';
                if (sidebarCollapsed) {
                    document.querySelector('.sidebar').classList.add('collapsed');
                }
                
                // Setup tab navigation
                setupTabNavigation();
                
                // Setup chat agent selection
                setupChatAgentSelection();
                
                // Setup agent chat messaging
                setupAgentChatMessaging();
                
                // Load initial data
                loadAgents();
                loadRoles();
                loadHierarchy();
                loadKPIs();
                loadBlockchainLogs();
                loadTickets();
                loadArchives();
                loadOrganizations();
                updateDashboardCostAnalytics();
                
                // Setup modal handlers
                setupModals();
                
                console.log(' Enhanced Dashboard initialized successfully');
            } catch (error) {
                console.error(' Dashboard initialization error:', error);
                showToast('Dashboard initialization failed: ' + error.message, 'error');
            }
        });
        
        // Tab Navigation with Title Updates
        function setupTabNavigation() {
            const navLinks = document.querySelectorAll('.nav-link[data-tab]');
            const tabContents = document.querySelectorAll('.tab-content');
            const pageTitle = document.getElementById('page-title');
            
            const tabTitles = {
                'dashboard': 'Organization Dashboard',
                'organizations': 'Multi-Tenant Organizations',
                'agents': 'Agent Management',
                'hierarchy': 'Hierarchy Builder',
                'chat': 'Agent Chat',
                'userbot': 'User Chatbot',
                'blockchain': 'Blockchain Logs',
                'tickets': 'Ticket Management',
                'archives': 'Data Archives',
                'analytics': 'Analytics',
                'roles': 'Role Management',
                'settings': 'Settings'
            };
            
            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    const targetTab = this.getAttribute('data-tab');
                    
                    // Update page title
                    if (pageTitle && tabTitles[targetTab]) {
                        pageTitle.textContent = tabTitles[targetTab];
                    }
                    
                    // Remove active class from all nav links
                    navLinks.forEach(l => l.classList.remove('active'));
                    
                    // Add active class to clicked link
                    this.classList.add('active');
                    
                    // Hide all tab contents
                    tabContents.forEach(content => {
                        content.classList.remove('active');
                    });
                    
                    // Show target tab content
                    const targetContent = document.getElementById(targetTab + '-content');
                    if (targetContent) {
                        targetContent.classList.add('active');
                        console.log(' Switched to tab:', targetTab);
                    }
                });
            });
            
            console.log(' Tab navigation setup complete');
        }
        
        // Setup Chat Agent Selection
        function setupChatAgentSelection() {
            const chatAgentItems = document.querySelectorAll('.chat-agent-item');
            
            chatAgentItems.forEach(item => {
                item.addEventListener('click', function() {
                    // Remove active class from all agent items
                    chatAgentItems.forEach(i => i.classList.remove('active'));
                    
                    // Add active class to clicked item
                    this.classList.add('active');
                    
                    // Get agent info
                    const agentId = this.getAttribute('data-agent-id');
                    const agentName = this.querySelector('.agent-name').textContent;
                    
                    console.log(' Selected chat agent:', agentName, '(' + agentId + ')');
                    
                    // Update chat header or clear messages (optional)
                    const chatMessages = document.querySelector('.chat-messages');
                    if (chatMessages) {
                        // You can add a system message indicating agent switch
                        const switchMessage = document.createElement('div');
                        switchMessage.className = 'chat-message system';
                        switchMessage.innerHTML = `
                            <div class="message-content">
                                <p style="text-align: center; color: #64748b; font-size: 0.875rem; padding: 1rem;">
                                    <i class="fas fa-exchange-alt"></i> Now chatting with <strong>${agentName}</strong>
                                </p>
                            </div>
                        `;
                        chatMessages.appendChild(switchMessage);
                        chatMessages.scrollTop = chatMessages.scrollHeight;
                    }
                });
            });
            
            console.log(' Chat agent selection setup complete');
        }
        
        // Setup Agent Chat Messaging
        function setupAgentChatMessaging() {
            const sendButton = document.getElementById('send-agent-message');
            const chatInput = document.getElementById('agent-chat-input');
            const chatMessages = document.querySelector('.chat-messages');
            
            if (!sendButton || !chatInput || !chatMessages) {
                console.warn(' Chat elements not found');
                return;
            }
            
            // Send message function
            async function sendMessage() {
                const message = chatInput.value.trim();
                if (!message) return;
                
                // Get selected agent
                const selectedAgent = document.querySelector('.chat-agent-item.active');
                if (!selectedAgent) {
                    showToast('Please select an agent first', 'warning');
                    return;
                }
                
                const agentId = selectedAgent.getAttribute('data-agent-id');
                const agentName = selectedAgent.querySelector('.agent-name').textContent;
                
                // Display user message
                const userMessageDiv = document.createElement('div');
                userMessageDiv.className = 'chat-message user';
                userMessageDiv.innerHTML = `
                    <div class="message-avatar">
                        <i class="fas fa-user"></i>
                    </div>
                    <div class="message-content">
                        <div class="message-header">
                            <span class="message-sender">You</span>
                            <span class="message-time">${new Date().toLocaleTimeString()}</span>
                        </div>
                        <div class="message-text">${escapeHtml(message)}</div>
                    </div>
                `;
                chatMessages.appendChild(userMessageDiv);
                
                // Clear input
                chatInput.value = '';
                
                // Scroll to bottom
                chatMessages.scrollTop = chatMessages.scrollHeight;
                
                // Show typing indicator
                const typingDiv = document.createElement('div');
                typingDiv.className = 'chat-message agent typing-indicator';
                typingDiv.innerHTML = `
                    <div class="message-avatar">
                        <i class="fas fa-robot"></i>
                    </div>
                    <div class="message-content">
                        <div class="message-text">
                            <span class="typing-dots">
                                <span>.</span><span>.</span><span>.</span>
                            </span>
                        </div>
                    </div>
                `;
                chatMessages.appendChild(typingDiv);
                chatMessages.scrollTop = chatMessages.scrollHeight;
                
                try {
                    // Send message to agent via API
                    const saveToBlockchain = document.getElementById('save-to-blockchain')?.checked || false;
                    
                    const response = await fetch(`${API_BASE_URL}/chat`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            agent_id: agentId,
                            message: message,
                            user_id: 'dashboard-user',
                            session_id: `session-${Date.now()}`
                        })
                    });
                    
                    // Remove typing indicator
                    typingDiv.remove();
                    
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    
                    const data = await response.json();
                    
                    // Display agent response
                    const agentMessageDiv = document.createElement('div');
                    agentMessageDiv.className = 'chat-message agent';
                    
                    // Check if blockchain info is available
                    const blockchainInfo = data.blockchain_hash 
                        ? `<div class="message-blockchain"><i class="fas fa-link"></i> Block #${data.block_number || 'N/A'} - Hash: ${data.blockchain_hash.substring(0, 10)}...</div>` 
                        : '';
                    
                    agentMessageDiv.innerHTML = `
                        <div class="message-avatar">
                            <i class="fas fa-robot"></i>
                        </div>
                        <div class="message-content">
                            <div class="message-header">
                                <span class="message-sender">${data.agent_name || agentName}</span>
                                <span class="message-time">${new Date(data.timestamp || new Date()).toLocaleTimeString()}</span>
                            </div>
                            <div class="message-text">${formatAgentResponse(data.response || 'No response')}</div>
                            ${blockchainInfo}
                        </div>
                    `;
                    chatMessages.appendChild(agentMessageDiv);
                    
                    // Scroll to bottom
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                    
                } catch (error) {
                    // Remove typing indicator
                    typingDiv.remove();
                    
                    console.error('Error sending message:', error);
                    
                    // Display error message
                    const errorMessageDiv = document.createElement('div');
                    errorMessageDiv.className = 'chat-message system';
                    errorMessageDiv.innerHTML = `
                        <div class="message-content">
                            <div class="message-text" style="color: #ef4444; text-align: center;">
                                <i class="fas fa-exclamation-triangle"></i> Error: ${error.message}
                            </div>
                        </div>
                    `;
                    chatMessages.appendChild(errorMessageDiv);
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                    
                    showToast('Failed to send message: ' + error.message, 'error');
                }
            }
            
            // Button click handler
            sendButton.addEventListener('click', sendMessage);
            
            // Enter key handler
            chatInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    sendMessage();
                }
            });
            
            console.log(' Agent chat messaging setup complete');
        }
        
        // HTML escape helper
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        // Format agent response with proper HTML structure
        function formatAgentResponse(text) {
            if (!text) return 'No response';
            
            // Escape HTML first for safety
            let formatted = escapeHtml(text);
            
            // Convert markdown-style formatting to HTML
            
            // Bold text: **text** or __text__
            formatted = formatted.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>');
            formatted = formatted.replace(/__(.+?)__/g, '<strong>$1</strong>');
            
            // Italic text: *text* or _text_
            formatted = formatted.replace(/\*(.+?)\*/g, '<em>$1</em>');
            formatted = formatted.replace(/_(.+?)_/g, '<em>$1</em>');
            
            // Code blocks: `code`
            formatted = formatted.replace(/`(.+?)`/g, '<code>$1</code>');
            
            // Split into paragraphs
            const paragraphs = formatted.split('\n\n');
            
            formatted = paragraphs.map(para => {
                para = para.trim();
                if (!para) return '';
                
                // Check for numbered lists (1. item or 1) item)
                if (/^\d+[\.\)]\s/.test(para)) {
                    const items = para.split('\n').filter(line => line.trim());
                    const listItems = items.map(item => {
                        const match = item.match(/^\d+[\.\)]\s*(.+)$/);
                        return match ? `<li>${match[1]}</li>` : `<li>${item}</li>`;
                    }).join('');
                    return `<ol>${listItems}</ol>`;
                }
                
                // Check for bullet lists (- item or * item or  item)
                if (/^[\-\*]\s/.test(para)) {
                    const items = para.split('\n').filter(line => line.trim());
                    const listItems = items.map(item => {
                        const match = item.match(/^[\-\*]\s*(.+)$/);
                        return match ? `<li>${match[1]}</li>` : `<li>${item}</li>`;
                    }).join('');
                    return `<ul>${listItems}</ul>`;
                }
                
                // Check for headers (# Header)
                if (/^#{1,6}\s/.test(para)) {
                    const match = para.match(/^(#{1,6})\s*(.+)$/);
                    if (match) {
                        const level = match[1].length;
                        return `<h${level} class="response-header">${match[2]}</h${level}>`;
                    }
                }
                
                // Regular paragraph
                return `<p>${para.replace(/\n/g, '<br>')}</p>`;
            }).join('');
            
            return formatted;
        }
        
        // Load Agents
        async function loadAgents() {
            try {
                const response = await fetch(`${API_BASE_URL}/agents?include_disabled=true`);
                const agents = await response.json();
                
                console.log(' Loaded agents:', agents);
                
                // Render agents in the agents grid
                const agentsGrid = document.querySelector('.agents-grid');
                if (agentsGrid && agents.length > 0) {
                    agentsGrid.innerHTML = agents.map(agent => {
                        const isDisabled = agent.status === 'disabled';
                        return `
                        <div class="agent-card ${isDisabled ? 'disabled' : ''}" data-agent-id="${agent.agent_id}">
                            <div class="agent-card-header">
                                <div class="agent-avatar large">
                                    <i class="fas ${getAgentIcon(agent.specialization)}"></i>
                                </div>
                                <div class="agent-badge ${agent.role}">${agent.role}</div>
                                ${isDisabled ? '<div class="agent-disabled-badge">DISABLED</div>' : ''}
                            </div>
                            <div class="agent-card-content">
                                <h4>${agent.name}</h4>
                                <p class="agent-type">${agent.specialization}</p>
                                <div class="agent-responsibilities">
                                    <div class="responsibility-tag">${agent.role.replace('_', ' ')}</div>
                                </div>
                            </div>
                            <div class="agent-card-actions">
                                <button class="btn btn-sm btn-outline" onclick="editAgent('${agent.agent_id}')" ${isDisabled ? 'disabled' : ''}>
                                    <i class="fas fa-edit"></i>
                                    Edit
                                </button>
                                <button class="btn btn-sm ${isDisabled ? 'btn-success' : 'btn-warning'}" onclick="toggleAgent('${agent.agent_id}', ${!isDisabled})">
                                    <i class="fas fa-power-off"></i>
                                    ${isDisabled ? 'Enable' : 'Disable'}
                                </button>
                                <button class="btn btn-sm btn-danger" onclick="deleteAgent('${agent.agent_id}', '${agent.name}')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    `;
                    }).join('');
                }
            } catch (error) {
                console.error('Failed to load agents:', error);
                showToast('Failed to load agents: ' + error.message, 'error');
            }
        }
        
        // Load Hierarchy
        async function loadHierarchy() {
            try {
                const response = await fetch(`${API_BASE_URL}/api/v1/agents/hierarchy`);
                const hierarchy = await response.json();
                
                console.log(' Loaded hierarchy:', hierarchy);
                
                // You can add hierarchy rendering here
                
            } catch (error) {
                console.error('Failed to load hierarchy:', error);
            }
        }
        
        // Load KPIs
        async function loadKPIs() {
            try {
                const response = await fetch(`${API_BASE_URL}/api/v1/dashboard/kpis`);
                const kpis = await response.json();
                
                console.log(' Loaded KPIs:', kpis);
                
                // Update KPI values
                const kpiElements = {
                    'active-agents': kpis.active_agents,
                    'total-messages': kpis.messages_processed,
                    'avg-response-time': kpis.avg_response_time,
                    'system-uptime': kpis.system_health
                };
                
                Object.keys(kpiElements).forEach(key => {
                    const element = document.querySelector(`[data-kpi="${key}"]`);
                    if (element) {
                        element.textContent = kpiElements[key];
                    }
                });
                
            } catch (error) {
                console.error('Failed to load KPIs:', error);
            }
        }
        
        // Load Blockchain Logs
        async function loadBlockchainLogs() {
            try {
                const response = await fetch(`${API_BASE_URL}/api/v1/blockchain/logs?limit=50`);
                const data = await response.json();
                
                console.log(' Loaded blockchain logs:', data);
                
                // Update stats
                document.getElementById('total-blocks').textContent = data.total_blocks || 0;
                document.getElementById('chain-valid').textContent = data.blockchain_valid ? 'Valid ' : 'Invalid ';
                document.getElementById('chain-valid').style.color = data.blockchain_valid ? '#10b981' : '#ef4444';
                
                // Render blockchain logs in list view
                const blockchainList = document.querySelector('.blockchain-list');
                
                if (!data.logs || data.logs.length === 0) {
                    blockchainList.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-link"></i>
                            <p>No blockchain logs yet</p>
                            <small>Start chatting with agents to create blockchain entries</small>
                        </div>
                    `;
                    return;
                }
                
                blockchainList.innerHTML = data.logs.map((log, index) => {
                    const messagePreview = log.message ? (log.message.length > 80 ? log.message.substring(0, 80) + '...' : log.message) : 'N/A';
                    const timestamp = new Date(log.timestamp).toLocaleString('en-US', { 
                        month: 'short', 
                        day: 'numeric', 
                        hour: '2-digit', 
                        minute: '2-digit' 
                    });
                    const type = log.message_type.toLowerCase();
                    const itemId = `blockchain-item-${index}`;
                    
                    // Determine icon based on type
                    let icon = 'fa-cube';
                    if (type === 'request') icon = 'fa-paper-plane';
                    else if (type === 'response') icon = 'fa-reply';
                    else if (type.includes('system')) icon = 'fa-cog';
                    
                    return `
                        <div class="blockchain-item" id="${itemId}" onclick="toggleBlockchainItem('${itemId}')">
                            <div class="blockchain-item-header">
                                <div class="blockchain-item-indicator ${type}"></div>
                                <div class="blockchain-item-icon ${type}">
                                    <i class="fas ${icon}"></i>
                                </div>
                                <div class="blockchain-item-info">
                                    <div class="blockchain-item-title">
                                        <div class="blockchain-item-agents">
                                            <span>${log.sender}</span>
                                            <span class="arrow"></span>
                                            <span>${log.recipient}</span>
                                        </div>
                                        <span class="blockchain-item-type ${type}">${type}</span>
                                    </div>
                                    <div class="blockchain-item-preview">${escapeHtml(messagePreview)}</div>
                                </div>
                                <div class="blockchain-item-meta">
                                    <div class="blockchain-item-block">
                                        <i class="fas fa-cube"></i>
                                        <span>#${log.block_number}</span>
                                    </div>
                                    <div class="blockchain-item-time">${timestamp}</div>
                                    <div class="blockchain-item-expand">
                                        <i class="fas fa-chevron-down"></i>
                                    </div>
                                </div>
                            </div>
                            <div class="blockchain-item-details">
                                <div class="blockchain-item-body">
                                    <div class="blockchain-detail-row">
                                        <div class="blockchain-detail-field">
                                            <div class="blockchain-detail-label">Block Number</div>
                                            <div class="blockchain-detail-value">#${log.block_number}</div>
                                        </div>
                                        <div class="blockchain-detail-field">
                                            <div class="blockchain-detail-label">Timestamp</div>
                                            <div class="blockchain-detail-value">${new Date(log.timestamp).toLocaleString()}</div>
                                        </div>
                                        <div class="blockchain-detail-field">
                                            <div class="blockchain-detail-label">Message Type</div>
                                            <div class="blockchain-detail-value">${log.message_type}</div>
                                        </div>
                                    </div>
                                    <div class="blockchain-detail-row">
                                        <div class="blockchain-detail-field">
                                            <div class="blockchain-detail-label">Block Hash</div>
                                            <div class="blockchain-detail-value hash">${log.full_hash}</div>
                                        </div>
                                    </div>
                                    <div class="blockchain-detail-row">
                                        <div class="blockchain-detail-field">
                                            <div class="blockchain-detail-label">Previous Hash</div>
                                            <div class="blockchain-detail-value hash">${log.previous_hash}</div>
                                        </div>
                                    </div>
                                    ${log.message !== 'Message logged (content hashed)' ? `
                                        <div class="blockchain-detail-message">
                                            <div class="blockchain-detail-message-label">Message Content</div>
                                            <div class="blockchain-detail-message-text">${escapeHtml(log.message)}</div>
                                        </div>
                                    ` : ''}
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
                
            } catch (error) {
                console.error('Failed to load blockchain logs:', error);
                showToast('Failed to load blockchain logs: ' + error.message, 'error');
            }
        }
        
        // Toggle blockchain item expansion
        function toggleBlockchainItem(itemId) {
            const item = document.getElementById(itemId);
            if (item) {
                item.classList.toggle('expanded');
            }
        }
        
        // Helper Functions
        function getAgentIcon(specialization) {
            const icons = {
                'Strategic Leadership': 'fa-crown',
                'Incident Management': 'fa-exclamation-triangle',
                'incident_management': 'fa-exclamation-triangle',
                'problem_management': 'fa-search',
                'change_management': 'fa-cogs'
            };
            return icons[specialization] || 'fa-user-tie';
        }
        
        // Agent Management Functions
        async function toggleAgent(agentId, disable) {
            const action = disable ? 'disable' : 'enable';
            try {
                const response = await fetch(`${API_BASE_URL}/agents/${agentId}/${action}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                if (response.ok) {
                    showToast(`Agent ${action}d successfully!`, 'success');
                    await loadAgents(); // Reload agents list
                } else {
                    const error = await response.json();
                    showToast(`Failed to ${action} agent: ${error.detail}`, 'error');
                }
            } catch (error) {
                console.error(`Error ${action}ing agent:`, error);
                showToast(`Error ${action}ing agent: ${error.message}`, 'error');
            }
        }
        
        async function deleteAgent(agentId, agentName) {
            if (!confirm(`Are you sure you want to delete agent "${agentName}"?\n\nThis action cannot be undone.`)) {
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE_URL}/agents/${agentId}`, {
                    method: 'DELETE',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                if (response.ok) {
                    showToast(`Agent "${agentName}" deleted successfully!`, 'success');
                    await loadAgents(); // Reload agents list
                } else {
                    const error = await response.json();
                    showToast(`Failed to delete agent: ${error.detail}`, 'error');
                }
            } catch (error) {
                console.error('Error deleting agent:', error);
                showToast(`Error deleting agent: ${error.message}`, 'error');
            }
        }
        
        async function editAgent(agentId) {
            try {
                // Fetch agent details
                const agentResponse = await fetch(`${API_BASE_URL}/agents`);
                const agents = await agentResponse.json();
                const agent = agents.find(a => a.agent_id === agentId);
                
                if (!agent) {
                    showToast('Agent not found', 'error');
                    return;
                }
                
                // Fetch roles to populate dropdown
                const rolesResponse = await fetch(`${API_BASE_URL}/roles`);
                const roles = await rolesResponse.json();
                
                // Populate role dropdown
                const roleSelect = document.getElementById('edit-agent-role');
                roleSelect.innerHTML = '<option value="">Select role...</option>' +
                    roles.filter(r => r.enabled).map(role => 
                        `<option value="${role.role_id}" ${role.role_id === agent.role ? 'selected' : ''}>
                            ${role.name} (Level ${role.level})
                        </option>`
                    ).join('');
                
                // Populate form fields
                document.getElementById('edit-agent-id').value = agent.agent_id;
                document.getElementById('edit-agent-name').value = agent.name;
                document.getElementById('edit-agent-type').value = agent.agent_type || agent.specialization;
                document.getElementById('edit-agent-specialization').value = agent.specialization;
                document.getElementById('edit-agent-model').value = 'gpt-4o-mini'; // Default since not returned by API
                
                // Show modal
                document.getElementById('edit-agent-modal').style.display = 'flex';
            } catch (error) {
                console.error('Error loading agent:', error);
                showToast('Error loading agent: ' + error.message, 'error');
            }
        }
        
        function chatWithAgent(agentId) {
            console.log('Chat with agent:', agentId);
            // Switch to chat tab
            document.querySelector('.nav-link[data-tab="chat"]').click();
        }
        
        // Role Management Functions
        async function loadRoles() {
            try {
                const response = await fetch(`${API_BASE_URL}/roles?include_disabled=true`);
                const roles = await response.json();
                
                console.log(' Loaded roles:', roles);
                
                const rolesGrid = document.querySelector('.roles-grid');
                if (rolesGrid && roles.length > 0) {
                    rolesGrid.innerHTML = roles.map(role => {
                        const isDisabled = !role.enabled;
                        const levelBadge = `Level ${role.level}`;
                        const permissionsText = role.permissions && role.permissions.length > 0 
                            ? role.permissions.join(', ') 
                            : 'No permissions';
                        
                        return `
                        <div class="role-card ${isDisabled ? 'disabled' : ''}" data-role-id="${role.role_id}">
                            <div class="role-card-header">
                                <div class="role-icon">
                                    <i class="fas fa-user-tag"></i>
                                </div>
                                <div class="role-badge level-${role.level}">${levelBadge}</div>
                                ${isDisabled ? '<div class="role-disabled-badge">DISABLED</div>' : ''}
                            </div>
                            <div class="role-card-content">
                                <h4>${role.name}</h4>
                                <p class="role-description">${role.description}</p>
                                <div class="role-permissions">
                                    <small><i class="fas fa-shield-alt"></i> ${permissionsText}</small>
                                </div>
                            </div>
                            <div class="role-card-actions">
                                <button class="btn btn-sm btn-outline" onclick="editRole('${role.role_id}')" ${isDisabled ? 'disabled' : ''}>
                                    <i class="fas fa-edit"></i>
                                    Edit
                                </button>
                                <button class="btn btn-sm ${isDisabled ? 'btn-success' : 'btn-warning'}" onclick="toggleRole('${role.role_id}', ${!isDisabled})">
                                    <i class="fas fa-power-off"></i>
                                    ${isDisabled ? 'Enable' : 'Disable'}
                                </button>
                                <button class="btn btn-sm btn-danger" onclick="deleteRole('${role.role_id}', '${role.name}')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    `;
                    }).join('');
                }
            } catch (error) {
                console.error('Failed to load roles:', error);
                showToast('Failed to load roles: ' + error.message, 'error');
            }
        }
        
        function showCreateRoleModal() {
            const modal = document.getElementById('role-modal');
            const form = document.getElementById('role-form');
            const title = document.getElementById('role-modal-title');
            const submitText = document.getElementById('role-submit-text');
            
            // Reset form and set to create mode
            form.reset();
            document.getElementById('role-edit-mode').value = 'false';
            document.getElementById('role-id').value = '';
            title.textContent = 'Create New Role';
            submitText.textContent = 'Create Role';
            
            modal.style.display = 'flex';
        }
        
        async function editRole(roleId) {
            try {
                // Fetch role details
                const response = await fetch(`${API_BASE_URL}/roles`);
                const roles = await response.json();
                const role = roles.find(r => r.role_id === roleId);
                
                if (!role) {
                    showToast('Role not found', 'error');
                    return;
                }
                
                // Populate form
                document.getElementById('role-id').value = role.role_id;
                document.getElementById('role-name').value = role.name;
                document.getElementById('role-level').value = role.level;
                document.getElementById('role-description').value = role.description;
                document.getElementById('role-responsibilities').value = role.responsibilities || '';
                document.getElementById('role-edit-mode').value = 'true';
                
                // Set permissions checkboxes
                document.querySelectorAll('input[name="permissions"]').forEach(checkbox => {
                    checkbox.checked = role.permissions && role.permissions.includes(checkbox.value);
                });
                
                // Update modal title and button
                document.getElementById('role-modal-title').textContent = 'Edit Role';
                document.getElementById('role-submit-text').textContent = 'Update Role';
                
                // Show modal
                document.getElementById('role-modal').style.display = 'flex';
            } catch (error) {
                console.error('Error loading role:', error);
                showToast('Error loading role: ' + error.message, 'error');
            }
        }
        
        async function toggleRole(roleId, disable) {
            const action = disable ? 'disable' : 'enable';
            try {
                const response = await fetch(`${API_BASE_URL}/roles/${roleId}/${action}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                if (response.ok) {
                    showToast(`Role ${action}d successfully!`, 'success');
                    await loadRoles();
                } else {
                    const error = await response.json();
                    showToast(`Failed to ${action} role: ${error.detail}`, 'error');
                }
            } catch (error) {
                console.error(`Error ${action}ing role:`, error);
                showToast(`Error ${action}ing role: ${error.message}`, 'error');
            }
        }
        
        async function deleteRole(roleId, roleName) {
            if (!confirm(`Are you sure you want to delete role "${roleName}"?\n\nThis action cannot be undone and will fail if any agents use this role.`)) {
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE_URL}/roles/${roleId}`, {
                    method: 'DELETE',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                if (response.ok) {
                    showToast(`Role "${roleName}" deleted successfully!`, 'success');
                    await loadRoles();
                } else {
                    const error = await response.json();
                    showToast(`Failed to delete role: ${error.detail}`, 'error');
                }
            } catch (error) {
                console.error('Error deleting role:', error);
                showToast(`Error deleting role: ${error.message}`, 'error');
            }
        }
        
        // Toast notification function
        function showToast(message, type = 'info') {
            // Create toast element if it doesn't exist
            let toast = document.querySelector('.toast-notification');
            if (!toast) {
                toast = document.createElement('div');
                toast.className = 'toast-notification';
                document.body.appendChild(toast);
            }
            
            // Set message and type
            toast.textContent = message;
            toast.className = `toast-notification toast-${type} show`;
            
            // Auto-hide after 3 seconds
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }
        
        // Modal Handlers
        function setupModals() {
            // Close modal buttons
            document.querySelectorAll('.modal-close').forEach(button => {
                button.addEventListener('click', function(e) {
                    e.preventDefault();
                    const modal = this.closest('.modal-overlay');
                    if (modal) {
                        modal.style.display = 'none';
                    }
                });
            });
            
            // Close modal when clicking outside
            document.querySelectorAll('.modal-overlay').forEach(overlay => {
                overlay.addEventListener('click', function(e) {
                    if (e.target === this) {
                        this.style.display = 'none';
                    }
                });
            });
            
            // General modal opener for all buttons with data-modal attribute
            document.querySelectorAll('[data-modal]').forEach(button => {
                button.addEventListener('click', async function(e) {
                    e.preventDefault();
                    const modalId = this.getAttribute('data-modal');
                    console.log('Opening modal:', modalId);
                    const modal = document.getElementById(modalId);
                    
                    if (modal) {
                        // Special handling for add-agent-modal
                        if (modalId === 'add-agent-modal') {
                            await loadRolesForAgentForm();
                        }
                        modal.style.display = 'flex';
                        console.log('Modal opened:', modalId);
                    } else {
                        console.error('Modal not found:', modalId);
                    }
                });
            });
            
            // Load roles into agent form dropdowns
            async function loadRolesForAgentForm() {
                try {
                    console.log('Loading roles for agent form...');
                    const response = await fetch(`${API_BASE_URL}/roles`);
                    const roles = await response.json();
                    
                    console.log('Loaded roles:', roles);
                    
                    // Sort roles by level (hierarchy)
                    roles.sort((a, b) => a.level - b.level);
                    
                    // Populate reportee role dropdown
                    const roleSelect = document.getElementById('agent-role');
                    roleSelect.innerHTML = '<option value="">Select role...</option>' +
                        roles.filter(r => r.enabled).map(role => 
                            `<option value="${role.role_id}" data-level="${role.level}">
                                ${role.name} (Level ${role.level})
                            </option>`
                        ).join('');
                    
                    // Store roles data for later use
                    window.rolesData = roles;
                    
                    console.log('Roles populated, stored in window.rolesData');
                    
                } catch (error) {
                    console.error('Failed to load roles:', error);
                    showToast('Failed to load roles', 'error');
                }
            }
            
            // Handle reportee role change to populate reporting manager dropdown
            const agentRoleSelect = document.getElementById('agent-role');
            if (agentRoleSelect) {
                agentRoleSelect.addEventListener('change', function() {
                    console.log('Agent role changed');
                    const selectedOption = this.options[this.selectedIndex];
                    const selectedLevel = parseInt(selectedOption.getAttribute('data-level'));
                    const reportingManagerSelect = document.getElementById('agent-reporting-manager');
                    const reportsToSelect = document.getElementById('agent-reports-to');
                    
                    console.log('Selected role:', selectedOption.value);
                    console.log('Selected level:', selectedLevel);
                    console.log('Roles data:', window.rolesData);
                    
                    // Clear the reports-to dropdown when role changes
                    reportsToSelect.innerHTML = '<option value="">Select a specific manager (optional)...</option>';
                    
                    if (!selectedLevel || !window.rolesData) {
                        reportingManagerSelect.innerHTML = '<option value="">Select reporting manager role...</option>';
                        return;
                    }
                    
                    // Filter roles with lower level number (higher in hierarchy)
                    const higherRoles = window.rolesData.filter(r => r.level < selectedLevel && r.enabled);
                    
                    console.log('Higher roles found:', higherRoles.length);
                    
                    if (higherRoles.length === 0) {
                        reportingManagerSelect.innerHTML = '<option value="">No higher roles available (Top of hierarchy)</option>';
                    } else {
                        reportingManagerSelect.innerHTML = '<option value="">Select reporting manager role...</option>' +
                            higherRoles.map(role => 
                                `<option value="${role.role_id}">
                                    ${role.name} (Level ${role.level})
                                </option>`
                            ).join('');
                    }
                });
            }
            
            // Handle reporting manager role change to populate specific agents dropdown
            const reportingManagerRoleSelect = document.getElementById('agent-reporting-manager');
            if (reportingManagerRoleSelect) {
                reportingManagerRoleSelect.addEventListener('change', async function() {
                    const selectedRole = this.value;
                    const reportsToSelect = document.getElementById('agent-reports-to');
                    
                    console.log('Reporting manager role changed to:', selectedRole);
                    
                    if (!selectedRole) {
                        reportsToSelect.innerHTML = '<option value="">Select a specific manager (optional)...</option>';
                        return;
                    }
                    
                    try {
                        // Fetch all agents
                        const response = await fetch(`${API_BASE_URL}/agents`);
                        const agents = await response.json();
                        
                        console.log('All agents:', agents);
                        
                        // Filter agents with the selected reporting manager role
                        const matchingAgents = agents.filter(agent => {
                            // Check if agent has the custom_role_id metadata
                            const agentRole = agent.role; // This is the role_id from backend
                            return agentRole === selectedRole;
                        });
                        
                        console.log('Matching agents for role', selectedRole, ':', matchingAgents);
                        
                        if (matchingAgents.length === 0) {
                            reportsToSelect.innerHTML = '<option value="">No agents available with this role yet</option>';
                        } else {
                            reportsToSelect.innerHTML = '<option value="">Select a specific manager (optional)...</option>' +
                                matchingAgents.map(agent => 
                                    `<option value="${agent.agent_id}">
                                        ${agent.name} (${agent.specialization})
                                    </option>`
                                ).join('');
                        }
                        
                    } catch (error) {
                        console.error('Failed to load agents:', error);
                        reportsToSelect.innerHTML = '<option value="">Error loading agents</option>';
                    }
                });
            }
            
            // Handle file upload preview
            document.getElementById('agent-responsibilities-doc').addEventListener('change', function() {
                const file = this.files[0];
                const preview = document.getElementById('doc-preview');
                const filename = document.getElementById('doc-filename');
                
                if (file) {
                    filename.textContent = file.name;
                    preview.style.display = 'block';
                } else {
                    preview.style.display = 'none';
                }
            });
            
            // Handle remove document button
            document.getElementById('remove-doc').addEventListener('click', function() {
                const fileInput = document.getElementById('agent-responsibilities-doc');
                fileInput.value = '';
                document.getElementById('doc-preview').style.display = 'none';
            });
            
            // Form submission - Add Agent
            const addAgentForm = document.getElementById('add-agent-form');
            if (addAgentForm) {
                addAgentForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    
                    const formData = new FormData(this);
                    
                    // Get form values
                    const name = formData.get('name');
                    const agent_type = formData.get('agent_type');
                    const role = formData.get('role');
                    const reporting_manager_role = formData.get('reporting_manager_role');
                    const reports_to_agent_id = formData.get('reports_to_agent_id');
                    const specialization = formData.get('specialization');
                    const model = formData.get('model') || 'gpt-4o-mini';
                    const responsibilitiesDoc = formData.get('responsibilities_doc');
                    
                    console.log('Creating agent with data:', {
                        name, agent_type, role, reporting_manager_role, reports_to_agent_id, specialization, model,
                        hasDocument: responsibilitiesDoc && responsibilitiesDoc.size > 0
                    });
                    
                    // Validate required fields
                    if (!name || !agent_type || !role || !specialization) {
                        showToast('Please fill in all required fields', 'error');
                        return;
                    }
                    
                    // Validate reporting manager for non-CEO roles
                    if (role !== 'ceo' && !reporting_manager_role) {
                        showToast('Please select a reporting manager role', 'error');
                        return;
                    }
                    
                    try {
                        // Show loading toast
                        showToast('Creating agent...', 'info');
                        
                        // Create request data with multipart form data for file upload
                        const requestFormData = new FormData();
                        requestFormData.append('name', name);
                        requestFormData.append('agent_type', agent_type);
                        requestFormData.append('role', role);
                        requestFormData.append('reporting_manager_role', reporting_manager_role || '');
                        requestFormData.append('reports_to_agent_id', reports_to_agent_id || '');
                        requestFormData.append('specialization', specialization);
                        requestFormData.append('model', model);
                        
                        // Add document if uploaded
                        if (responsibilitiesDoc && responsibilitiesDoc.size > 0) {
                            requestFormData.append('responsibilities_doc', responsibilitiesDoc);
                        }
                        
                        // Send POST request to create agent with file upload
                        const response = await fetch(`${API_BASE_URL}/agents`, {
                            method: 'POST',
                            body: requestFormData
                            // Note: Don't set Content-Type header - browser will set it with boundary for multipart/form-data
                        });
                        
                        if (!response.ok) {
                            const error = await response.json();
                            throw new Error(error.detail || 'Failed to create agent');
                        }
                        
                        const newAgent = await response.json();
                        
                        console.log(' Agent created successfully:', newAgent);
                        
                        // Show success toast
                        showToast(`Agent "${newAgent.name}" created successfully!`, 'success');
                        
                        // Close modal
                        document.getElementById('add-agent-modal').style.display = 'none';
                        this.reset();
                        document.getElementById('doc-preview').style.display = 'none';
                        
                        // Reload agents list
                        await loadAgents();
                        
                        // Switch to agents tab to see the new agent
                        const agentsTab = document.querySelector('.nav-link[data-tab="agents"]');
                        if (agentsTab) {
                            agentsTab.click();
                        }
                        
                    } catch (error) {
                        console.error('Failed to create agent:', error);
                        showToast(`Error: ${error.message}`, 'error');
                    }
                });
            }
            
            // Form submission - Create/Edit Role
            const roleForm = document.getElementById('role-form');
            if (roleForm) {
                roleForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    
                    const formData = new FormData(this);
                    const isEditMode = document.getElementById('role-edit-mode').value === 'true';
                    const roleId = document.getElementById('role-id').value;
                    
                    // Collect permissions
                    const permissions = Array.from(document.querySelectorAll('input[name="permissions"]:checked'))
                        .map(cb => cb.value);
                    
                    const roleData = {
                        role_id: roleId || formData.get('name').toLowerCase().replace(/\s+/g, '_'),
                        name: formData.get('name'),
                        description: formData.get('description'),
                        responsibilities: formData.get('responsibilities') || '',
                        level: parseInt(formData.get('level')),
                        permissions: permissions,
                        enabled: true
                    };
                    
                    console.log(isEditMode ? 'Updating' : 'Creating', 'role with data:', roleData);
                    
                    // Validate required fields
                    if (!roleData.name || !roleData.description || !roleData.level || !roleData.responsibilities) {
                        showToast('Please fill in all required fields', 'error');
                        return;
                    }
                    
                    try {
                        showToast(isEditMode ? 'Updating role...' : 'Creating role...', 'info');
                        
                        const url = isEditMode 
                            ? `${API_BASE_URL}/roles/${roleData.role_id}`
                            : `${API_BASE_URL}/roles`;
                        
                        const method = isEditMode ? 'PUT' : 'POST';
                        
                        const response = await fetch(url, {
                            method: method,
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify(roleData)
                        });
                        
                        if (!response.ok) {
                            const error = await response.json();
                            throw new Error(error.detail || `Failed to ${isEditMode ? 'update' : 'create'} role`);
                        }
                        
                        const result = await response.json();
                        console.log(' Role saved successfully:', result);
                        
                        showToast(`Role "${roleData.name}" ${isEditMode ? 'updated' : 'created'} successfully!`, 'success');
                        
                        // Close modal and reload
                        document.getElementById('role-modal').style.display = 'none';
                        this.reset();
                        await loadRoles();
                        
                        // Switch to roles tab
                        const rolesTab = document.querySelector('.nav-link[data-tab="roles"]');
                        if (rolesTab) {
                            rolesTab.click();
                        }
                        
                    } catch (error) {
                        console.error('Failed to save role:', error);
                        showToast(`Error: ${error.message}`, 'error');
                    }
                });
            }
            
            // Form submission - Edit Agent
            const editAgentForm = document.getElementById('edit-agent-form');
            if (editAgentForm) {
                editAgentForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    
                    const formData = new FormData(this);
                    const agentId = document.getElementById('edit-agent-id').value;
                    
                    const updateData = {
                        name: formData.get('name'),
                        agent_type: formData.get('agent_type'),
                        role: formData.get('role'),
                        specialization: formData.get('specialization'),
                        model: formData.get('model')
                    };
                    
                    console.log('Updating agent:', agentId, 'with data:', updateData);
                    
                    // Validate required fields
                    if (!updateData.name || !updateData.agent_type || !updateData.role || !updateData.specialization) {
                        showToast('Please fill in all required fields', 'error');
                        return;
                    }
                    
                    try {
                        showToast('Updating agent...', 'info');
                        
                        const response = await fetch(`${API_BASE_URL}/agents/${agentId}`, {
                            method: 'PUT',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify(updateData)
                        });
                        
                        if (!response.ok) {
                            const error = await response.json();
                            throw new Error(error.detail || 'Failed to update agent');
                        }
                        
                        const result = await response.json();
                        console.log(' Agent updated successfully:', result);
                        
                        showToast(`Agent "${updateData.name}" updated successfully!`, 'success');
                        
                        // Close modal and reload
                        document.getElementById('edit-agent-modal').style.display = 'none';
                        this.reset();
                        await loadAgents();
                        
                        // Switch to agents tab
                        const agentsTab = document.querySelector('.nav-link[data-tab="agents"]');
                        if (agentsTab) {
                            agentsTab.click();
                        }
                        
                    } catch (error) {
                        console.error('Failed to update agent:', error);
                        showToast(`Error: ${error.message}`, 'error');
                    }
                });
            }
        }
        
        // Toast Notification
        function showToast(message, type = 'info') {
            const toastContainer = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            
            // Choose icon based on type
            const icons = {
                'info': 'fa-info-circle',
                'success': 'fa-check-circle',
                'warning': 'fa-exclamation-triangle',
                'error': 'fa-times-circle'
            };
            
            toast.innerHTML = `
                <div class="toast-content">
                    <i class="fas ${icons[type] || icons.info}"></i>
                    <span>${message}</span>
                </div>
            `;
            
            toastContainer.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }
        
        // Utility function to show info message
        window.showInfo = function(title, message) {
            alert(title + '\\n\\n' + message);
        };

        // ===== TICKET MANAGEMENT FUNCTIONS =====

        // Global tickets storage
        let allTickets = [];

        // Load tickets from backend
        async function loadTickets() {
            try {
                const response = await fetch(`${API_BASE_URL}/api/v1/tickets`);
                if (!response.ok) {
                    // If endpoint doesn't exist yet, use sample data
                    console.log('Tickets endpoint not available yet, using sample data');
                    allTickets = getSampleTickets();
                } else {
                    allTickets = await response.json();
                }
                
                updateTicketStats();
                renderTickets();
            } catch (error) {
                console.error('Error loading tickets:', error);
                // Use sample data for now
                allTickets = getSampleTickets();
                updateTicketStats();
                renderTickets();
            }
        }

        // Sample tickets for testing
        function getSampleTickets() {
            return [
                {
                    id: 'TKT-001',
                    title: 'API Authentication Issue',
                    description: 'Users are experiencing authentication failures when trying to access the API endpoints. Need to investigate the token validation mechanism.',
                    status: 'active',
                    priority: 'high',
                    created_at: '2024-01-15T10:30:00Z',
                    created_by: 'John Doe',
                    assigned_to: 'Security Agent',
                    category: 'Bug',
                    tags: ['api', 'security', 'urgent']
                },
                {
                    id: 'TKT-002',
                    title: 'Dashboard Performance Optimization',
                    description: 'The main dashboard is loading slowly when there are many agents active. Need to optimize the rendering and data fetching.',
                    status: 'in_progress',
                    priority: 'medium',
                    created_at: '2024-01-14T14:20:00Z',
                    created_by: 'Jane Smith',
                    assigned_to: 'Development Agent',
                    category: 'Enhancement',
                    tags: ['performance', 'frontend']
                },
                {
                    id: 'TKT-003',
                    title: 'Add Export Feature for Reports',
                    description: 'Users have requested the ability to export analytics reports to PDF and Excel formats.',
                    status: 'active',
                    priority: 'low',
                    created_at: '2024-01-13T09:15:00Z',
                    created_by: 'Admin',
                    assigned_to: null,
                    category: 'Feature Request',
                    tags: ['export', 'reports']
                },
                {
                    id: 'TKT-004',
                    title: 'Blockchain Logging Verification',
                    description: 'Completed verification of blockchain logging integrity and implemented audit trail.',
                    status: 'resolved',
                    priority: 'high',
                    created_at: '2024-01-10T11:00:00Z',
                    created_by: 'Security Team',
                    assigned_to: 'Blockchain Agent',
                    category: 'Security',
                    tags: ['blockchain', 'audit', 'completed']
                },
                {
                    id: 'TKT-005',
                    title: 'Documentation Update Required',
                    description: 'API documentation needs to be updated with new endpoints.',
                    status: 'inactive',
                    priority: 'low',
                    created_at: '2024-01-08T16:45:00Z',
                    created_by: 'Tech Writer',
                    assigned_to: null,
                    category: 'Documentation',
                    tags: ['docs']
                }
            ];
        }

        // Update ticket statistics
        function updateTicketStats() {
            const stats = {
                active: 0,
                in_progress: 0,
                resolved: 0,
                inactive: 0
            };

            allTickets.forEach(ticket => {
                if (stats.hasOwnProperty(ticket.status)) {
                    stats[ticket.status]++;
                }
            });

            document.getElementById('active-tickets-count').textContent = stats.active;
            document.getElementById('progress-tickets-count').textContent = stats.in_progress;
            document.getElementById('resolved-tickets-count').textContent = stats.resolved;
            document.getElementById('inactive-tickets-count').textContent = stats.inactive;
        }

        // Filter tickets based on status, priority, and search
        function filterTickets() {
            const statusFilter = document.getElementById('ticket-status-filter').value;
            const priorityFilter = document.getElementById('ticket-priority-filter').value;
            const searchTerm = document.getElementById('ticket-search').value.toLowerCase();

            const filtered = allTickets.filter(ticket => {
                const matchesStatus = statusFilter === 'all' || ticket.status === statusFilter;
                const matchesPriority = priorityFilter === 'all' || ticket.priority === priorityFilter;
                const matchesSearch = !searchTerm || 
                    ticket.title.toLowerCase().includes(searchTerm) ||
                    ticket.description.toLowerCase().includes(searchTerm) ||
                    ticket.id.toLowerCase().includes(searchTerm);

                return matchesStatus && matchesPriority && matchesSearch;
            });

            renderTickets(filtered);
        }

        // Render tickets in the list
        function renderTickets(tickets = allTickets) {
            const ticketsList = document.querySelector('.tickets-list');
            
            if (tickets.length === 0) {
                ticketsList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-ticket-alt"></i>
                        <p>No tickets found</p>
                        <small>Try adjusting your filters</small>
                    </div>
                `;
                return;
            }

            ticketsList.innerHTML = tickets.map(ticket => {
                const createdDate = new Date(ticket.created_at).toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric'
                });

                const iconClass = {
                    'active': 'fa-hourglass-half',
                    'in_progress': 'fa-spinner',
                    'resolved': 'fa-check-circle',
                    'inactive': 'fa-pause-circle'
                }[ticket.status] || 'fa-ticket-alt';

                return `
                    <div class="ticket-item" data-ticket-id="${ticket.id}">
                        <div class="ticket-item-header" onclick="toggleTicket('${ticket.id}')">
                            <div class="ticket-indicator ${ticket.status}"></div>
                            <div class="ticket-icon ${ticket.status}">
                                <i class="fas ${iconClass}"></i>
                            </div>
                            <div class="ticket-summary">
                                <div class="ticket-title-row">
                                    <span class="ticket-title">${ticket.title}</span>
                                    <span class="ticket-id">${ticket.id}</span>
                                    <span class="ticket-priority-badge ${ticket.priority}">${ticket.priority}</span>
                                </div>
                                <div class="ticket-meta">
                                    <div class="ticket-meta-item">
                                        <i class="fas fa-calendar"></i>
                                        <span>${createdDate}</span>
                                    </div>
                                    <div class="ticket-meta-item">
                                        <i class="fas fa-user"></i>
                                        <span>Created by: ${ticket.created_by}</span>
                                    </div>
                                    <div class="ticket-meta-item">
                                        <i class="fas fa-user-tie"></i>
                                        <span>Assigned to: ${ticket.assigned_to || 'Unassigned'}</span>
                                    </div>
                                </div>
                            </div>
                            <i class="fas fa-chevron-down ticket-expand-icon"></i>
                        </div>
                        <div class="ticket-details">
                            <div class="ticket-description">
                                <h4>Description</h4>
                                <p>${ticket.description}</p>
                            </div>
                            ${ticket.tags && ticket.tags.length > 0 ? `
                                <div class="ticket-tags">
                                    ${ticket.tags.map(tag => `<span class="ticket-tag">${tag}</span>`).join('')}
                                </div>
                            ` : ''}
                            <div class="ticket-actions">
                                <button class="ticket-action-btn" onclick="editTicket('${ticket.id}')">
                                    <i class="fas fa-edit"></i> Edit
                                </button>
                                <button class="ticket-action-btn" onclick="changeTicketStatus('${ticket.id}', 'in_progress')">
                                    <i class="fas fa-play"></i> Start
                                </button>
                                <button class="ticket-action-btn" onclick="changeTicketStatus('${ticket.id}', 'resolved')">
                                    <i class="fas fa-check"></i> Resolve
                                </button>
                                <button class="ticket-action-btn" onclick="deleteTicket('${ticket.id}')">
                                    <i class="fas fa-trash"></i> Delete
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Toggle ticket expansion
        function toggleTicket(ticketId) {
            const ticketItem = document.querySelector(`[data-ticket-id="${ticketId}"]`);
            if (ticketItem) {
                ticketItem.classList.toggle('expanded');
            }
        }

        // Show create ticket modal
        function showCreateTicketModal() {
            const modal = document.getElementById('create-ticket-modal');
            modal.style.display = 'flex';
            
            // Load agents for assignment
            loadAgentsForTicketAssignment();
        }

        // Load agents for ticket assignment dropdown
        async function loadAgentsForTicketAssignment() {
            try {
                const response = await fetch(`${API_BASE_URL}/agents`);
                const agents = await response.json();
                
                const select = document.getElementById('ticket-assigned-to');
                select.innerHTML = '<option value="">Unassigned</option>';
                
                agents.forEach(agent => {
                    const option = document.createElement('option');
                    option.value = agent.id;
                    option.textContent = `${agent.name} (${agent.specialization || agent.agent_type})`;
                    select.appendChild(option);
                });
            } catch (error) {
                console.error('Error loading agents for ticket assignment:', error);
            }
        }

        // Handle create ticket form submission
        document.addEventListener('DOMContentLoaded', function() {
            const createTicketForm = document.getElementById('create-ticket-form');
            if (createTicketForm) {
                createTicketForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    
                    const formData = new FormData(this);
                    const ticketData = {
                        id: `TKT-${String(allTickets.length + 1).padStart(3, '0')}`,
                        title: formData.get('title'),
                        description: formData.get('description'),
                        priority: formData.get('priority'),
                        status: formData.get('status'),
                        assigned_to: formData.get('assigned_to'),
                        category: formData.get('category'),
                        tags: formData.get('tags') ? formData.get('tags').split(',').map(t => t.trim()) : [],
                        created_at: new Date().toISOString(),
                        created_by: 'Current User'
                    };

                    try {
                        // Try to send to backend
                        const response = await fetch(`${API_BASE_URL}/api/v1/tickets`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(ticketData)
                        });

                        if (!response.ok) {
                            throw new Error('Backend not available');
                        }

                        const result = await response.json();
                        allTickets.push(result);
                    } catch (error) {
                        console.log('Adding ticket locally (backend not available)');
                        allTickets.push(ticketData);
                    }

                    // Update UI
                    updateTicketStats();
                    renderTickets();
                    
                    // Close modal and reset form
                    document.getElementById('create-ticket-modal').style.display = 'none';
                    this.reset();
                    
                    showToast('Ticket created successfully', 'success');
                });
            }
        });

        // Change ticket status
        async function changeTicketStatus(ticketId, newStatus) {
            const ticket = allTickets.find(t => t.id === ticketId);
            if (!ticket) return;

            const oldStatus = ticket.status;
            ticket.status = newStatus;

            try {
                // Try to update backend
                await fetch(`${API_BASE_URL}/api/v1/tickets/${ticketId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ status: newStatus })
                });
            } catch (error) {
                console.log('Ticket status updated locally only');
            }

            updateTicketStats();
            renderTickets();
            showToast(`Ticket ${ticketId} status changed to ${newStatus}`, 'success');
        }

        // Edit ticket
        function editTicket(ticketId) {
            const ticket = allTickets.find(t => t.id === ticketId);
            if (!ticket) return;

            showToast('Edit functionality will be implemented soon', 'info');
        }

        // Delete ticket
        async function deleteTicket(ticketId) {
            if (!confirm('Are you sure you want to delete this ticket?')) return;

            const index = allTickets.findIndex(t => t.id === ticketId);
            if (index === -1) return;

            try {
                // Try to delete from backend
                await fetch(`${API_BASE_URL}/api/v1/tickets/${ticketId}`, {
                    method: 'DELETE'
                });
            } catch (error) {
                console.log('Ticket deleted locally only');
            }

            allTickets.splice(index, 1);
            updateTicketStats();
            renderTickets();
            showToast('Ticket deleted successfully', 'success');
        }

        // ===== DATA ARCHIVES MANAGEMENT FUNCTIONS =====

        // Global archives storage
        let allArchives = [];

        // Load archives from backend
        async function loadArchives() {
            try {
                const response = await fetch(`${API_BASE_URL}/api/v1/archives`);
                if (!response.ok) {
                    console.log('Archives endpoint not available yet, using sample data');
                    allArchives = getSampleArchives();
                } else {
                    allArchives = await response.json();
                }
                
                updateArchiveStats();
                renderArchives();
            } catch (error) {
                console.error('Error loading archives:', error);
                allArchives = getSampleArchives();
                updateArchiveStats();
                renderArchives();
            }
        }

        // Sample archives for testing
        function getSampleArchives() {
            return [
                {
                    id: 'DOC-001',
                    title: 'IT Security Policy',
                    description: 'Comprehensive IT security guidelines and best practices for the organization',
                    category: 'policies',
                    department: 'IT',
                    file_type: 'pdf',
                    file_size: 2.5,
                    uploaded_at: '2024-01-15T10:00:00Z',
                    uploaded_by: 'Admin',
                    tags: ['security', 'IT', 'compliance'],
                    searchable: true
                },
                {
                    id: 'DOC-002',
                    title: 'Employee Onboarding Guide',
                    description: 'Complete guide for new employee onboarding process',
                    category: 'guidelines',
                    department: 'HR',
                    file_type: 'docx',
                    file_size: 1.8,
                    uploaded_at: '2024-01-14T14:30:00Z',
                    uploaded_by: 'HR Manager',
                    tags: ['onboarding', 'HR', 'training'],
                    searchable: true
                },
                {
                    id: 'DOC-003',
                    title: 'Incident Response Procedures',
                    description: 'Step-by-step procedures for handling security incidents',
                    category: 'procedures',
                    department: 'IT',
                    file_type: 'pdf',
                    file_size: 3.2,
                    uploaded_at: '2024-01-12T09:15:00Z',
                    uploaded_by: 'Security Team',
                    tags: ['security', 'incident', 'procedures'],
                    searchable: true
                },
                {
                    id: 'DOC-004',
                    title: 'Code of Conduct',
                    description: 'Organization code of conduct and ethics guidelines',
                    category: 'policies',
                    department: 'HR',
                    file_type: 'pdf',
                    file_size: 1.2,
                    uploaded_at: '2024-01-10T11:00:00Z',
                    uploaded_by: 'Executive Team',
                    tags: ['ethics', 'conduct', 'policy'],
                    searchable: true
                },
                {
                    id: 'DOC-005',
                    title: 'API Documentation',
                    description: 'Technical reference for internal API endpoints',
                    category: 'reference',
                    department: 'IT',
                    file_type: 'txt',
                    file_size: 0.5,
                    uploaded_at: '2024-01-08T16:45:00Z',
                    uploaded_by: 'Dev Team',
                    tags: ['API', 'documentation', 'technical'],
                    searchable: true
                }
            ];
        }

        // Update archive statistics
        function updateArchiveStats() {
            const totalDocs = allArchives.length;
            const guidelines = allArchives.filter(d => d.category === 'guidelines').length;
            const policies = allArchives.filter(d => d.category === 'policies').length;
            const totalSize = allArchives.reduce((sum, doc) => sum + (doc.file_size || 0), 0);

            document.getElementById('total-documents-count').textContent = totalDocs;
            document.getElementById('guidelines-count').textContent = guidelines;
            document.getElementById('policies-count').textContent = policies;
            document.getElementById('total-size').textContent = totalSize.toFixed(1) + ' MB';
        }

        // Filter archives
        function filterArchives() {
            const categoryFilter = document.getElementById('archive-category-filter').value;
            const typeFilter = document.getElementById('archive-type-filter').value;
            const searchTerm = document.getElementById('archive-search').value.toLowerCase();

            const filtered = allArchives.filter(doc => {
                const matchesCategory = categoryFilter === 'all' || doc.category === categoryFilter;
                const matchesType = typeFilter === 'all' || doc.file_type === typeFilter;
                const matchesSearch = !searchTerm || 
                    doc.title.toLowerCase().includes(searchTerm) ||
                    doc.description.toLowerCase().includes(searchTerm) ||
                    doc.id.toLowerCase().includes(searchTerm) ||
                    (doc.tags && doc.tags.some(tag => tag.toLowerCase().includes(searchTerm)));

                return matchesCategory && matchesType && matchesSearch;
            });

            renderArchives(filtered);
        }

        // Render archives list
        function renderArchives(archives = allArchives) {
            const archivesList = document.querySelector('.archives-list');
            
            if (archives.length === 0) {
                archivesList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-archive"></i>
                        <p>No documents found</p>
                        <small>Try adjusting your filters or upload a new document</small>
                    </div>
                `;
                return;
            }

            archivesList.innerHTML = archives.map(doc => {
                const uploadedDate = new Date(doc.uploaded_at).toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric'
                });

                const fileIcon = {
                    'pdf': 'fa-file-pdf',
                    'docx': 'fa-file-word',
                    'txt': 'fa-file-alt'
                }[doc.file_type] || 'fa-file';

                const categoryColors = {
                    'guidelines': { bg: '#f0fdf4', color: '#10b981', border: '#10b981' },
                    'policies': { bg: '#fef3c7', color: '#f59e0b', border: '#f59e0b' },
                    'procedures': { bg: '#eff6ff', color: '#3b82f6', border: '#3b82f6' },
                    'templates': { bg: '#fce7f3', color: '#ec4899', border: '#ec4899' },
                    'reference': { bg: '#f3e8ff', color: '#a855f7', border: '#a855f7' },
                    'other': { bg: '#f1f5f9', color: '#64748b', border: '#64748b' }
                };

                const colors = categoryColors[doc.category] || categoryColors.other;

                return `
                    <div class="archive-item" data-archive-id="${doc.id}">
                        <div class="archive-item-header">
                            <div class="archive-indicator" style="background: ${colors.color};"></div>
                            <div class="archive-icon" style="background: ${colors.bg}; color: ${colors.color}; border-color: ${colors.border};">
                                <i class="fas ${fileIcon}"></i>
                            </div>
                            <div class="archive-summary">
                                <div class="archive-title-row">
                                    <span class="archive-title">${doc.title}</span>
                                    <span class="archive-id">${doc.id}</span>
                                    <span class="archive-category-badge" style="background: ${colors.bg}; color: ${colors.color};">${doc.category}</span>
                                </div>
                                <div class="archive-meta">
                                    <div class="archive-meta-item">
                                        <i class="fas fa-calendar"></i>
                                        <span>${uploadedDate}</span>
                                    </div>
                                    <div class="archive-meta-item">
                                        <i class="fas fa-user"></i>
                                        <span>${doc.uploaded_by}</span>
                                    </div>
                                    <div class="archive-meta-item">
                                        <i class="fas fa-building"></i>
                                        <span>${doc.department || 'General'}</span>
                                    </div>
                                    <div class="archive-meta-item">
                                        <i class="fas fa-database"></i>
                                        <span>${doc.file_size} MB</span>
                                    </div>
                                    ${doc.searchable ? '<div class="archive-meta-item"><i class="fas fa-search"></i><span>Searchable</span></div>' : ''}
                                </div>
                                ${doc.description ? `<div class="archive-description">${doc.description}</div>` : ''}
                                ${doc.tags && doc.tags.length > 0 ? `
                                    <div class="archive-tags">
                                        ${doc.tags.map(tag => `<span class="archive-tag">${tag}</span>`).join('')}
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                        <div class="archive-actions">
                            <button class="archive-action-btn" onclick="downloadDocument('${doc.id}')">
                                <i class="fas fa-download"></i> Download
                            </button>
                            <button class="archive-action-btn" onclick="viewDocument('${doc.id}')">
                                <i class="fas fa-eye"></i> View
                            </button>
                            <button class="archive-action-btn" onclick="editDocument('${doc.id}')">
                                <i class="fas fa-edit"></i> Edit
                            </button>
                            <button class="archive-action-btn" onclick="deleteDocument('${doc.id}')">
                                <i class="fas fa-trash"></i> Delete
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Show upload document modal
        function showUploadDocumentModal() {
            const modal = document.getElementById('upload-document-modal');
            modal.style.display = 'flex';
        }

        // Handle upload document form submission
        document.addEventListener('DOMContentLoaded', function() {
            const uploadForm = document.getElementById('upload-document-form');
            if (uploadForm) {
                uploadForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    
                    const formData = new FormData(this);
                    const fileInput = document.getElementById('document-file');
                    const file = fileInput.files[0];

                    if (!file) {
                        showToast('Please select a file to upload', 'error');
                        return;
                    }

                    // Check file size (max 10MB)
                    if (file.size > 10 * 1024 * 1024) {
                        showToast('File size must be less than 10MB', 'error');
                        return;
                    }

                    try {
                        const response = await fetch(`${API_BASE_URL}/api/v1/archives`, {
                            method: 'POST',
                            body: formData
                        });

                        if (!response.ok) {
                            throw new Error('Upload failed');
                        }

                        const result = await response.json();
                        allArchives.push(result);
                        
                        updateArchiveStats();
                        renderArchives();
                        
                        document.getElementById('upload-document-modal').style.display = 'none';
                        this.reset();
                        
                        showToast('Document uploaded successfully', 'success');
                    } catch (error) {
                        console.error('Upload error:', error);
                        showToast('Error uploading document. Please try again.', 'error');
                    }
                });
            }
        });

        // Download document
        function downloadDocument(docId) {
            const doc = allArchives.find(d => d.id === docId);
            if (!doc) return;

            showToast(`Downloading ${doc.title}...`, 'info');
            // In production, this would trigger actual file download
            window.open(`${API_BASE_URL}/api/v1/archives/${docId}/download`, '_blank');
        }

        // View document
        function viewDocument(docId) {
            const doc = allArchives.find(d => d.id === docId);
            if (!doc) return;

            showToast(`Opening ${doc.title}...`, 'info');
            // In production, this would open document viewer
            window.open(`${API_BASE_URL}/api/v1/archives/${docId}/view`, '_blank');
        }

        // Edit document
        function editDocument(docId) {
            const doc = allArchives.find(d => d.id === docId);
            if (!doc) return;

            showToast('Edit functionality will be implemented soon', 'info');
        }

        // Delete document
        async function deleteDocument(docId) {
            if (!confirm('Are you sure you want to delete this document?')) return;

            const index = allArchives.findIndex(d => d.id === docId);
            if (index === -1) return;

            try {
                await fetch(`${API_BASE_URL}/api/v1/archives/${docId}`, {
                    method: 'DELETE'
                });
            } catch (error) {
                console.log('Document deleted locally only');
            }

            allArchives.splice(index, 1);
            updateArchiveStats();
            renderArchives();
            showToast('Document deleted successfully', 'success');
        }

        // ===== ORGANIZATION MANAGEMENT =====
        
        let allOrganizations = [];
        let currentOrganization = null;

        // Load organizations
        async function loadOrganizations() {
            try {
                const response = await fetch(`${API_BASE_URL}/api/v1/organizations`);
                if (response.ok) {
                    const data = await response.json();
                    allOrganizations = data.organizations || [];
                    renderOrganizations();
                    updateOrganizationStats();
                } else {
                    console.error('Failed to load organizations');
                    allOrganizations = getSampleOrganizations();
                    renderOrganizations();
                    updateOrganizationStats();
                }
            } catch (error) {
                console.error('Error loading organizations:', error);
                allOrganizations = getSampleOrganizations();
                renderOrganizations();
                updateOrganizationStats();
            }
        }

        // Sample organizations for demo
        function getSampleOrganizations() {
            return [
                {
                    tenant_id: 'tenant_demo1',
                    name: 'Acme Corporation',
                    industry: 'tech',
                    size: 'medium',
                    tier: 'professional',
                    created_at: new Date().toISOString(),
                    usage: {
                        total_queries: 15420,
                        slm_queries: 10794,
                        llm_queries: 4626,
                        slm_percentage: 70,
                        estimated_cost: 245.50
                    }
                },
                {
                    tenant_id: 'tenant_demo2',
                    name: 'FinanceOne Inc',
                    industry: 'finance',
                    size: 'large',
                    tier: 'enterprise',
                    created_at: new Date().toISOString(),
                    usage: {
                        total_queries: 45800,
                        slm_queries: 27480,
                        llm_queries: 18320,
                        slm_percentage: 60,
                        estimated_cost: 1250.75
                    }
                },
                {
                    tenant_id: 'tenant_demo3',
                    name: 'TechStart Labs',
                    industry: 'tech',
                    size: 'small',
                    tier: 'basic',
                    created_at: new Date().toISOString(),
                    usage: {
                        total_queries: 2340,
                        slm_queries: 1872,
                        llm_queries: 468,
                        slm_percentage: 80,
                        estimated_cost: 42.30
                    }
                }
            ];
        }

        // Render organizations
        function renderOrganizations() {
            const container = document.getElementById('organizations-container');
            if (!container) return;

            if (allOrganizations.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-building"></i>
                        <h3>No Organizations Yet</h3>
                        <p>Create your first organization to get started</p>
                        <button class="btn btn-primary" data-modal="create-organization-modal">
                            <i class="fas fa-plus"></i> Create Organization
                        </button>
                    </div>
                `;
                return;
            }

            container.innerHTML = allOrganizations.map(org => `
                <div class="organization-card" data-tenant-id="${org.tenant_id}">
                    <div class="org-card-header">
                        <div class="org-icon ${org.industry}">
                            <i class="fas ${getIndustryIcon(org.industry)}"></i>
                        </div>
                        <div class="org-info">
                            <h3>${org.name}</h3>
                            <div class="org-meta">
                                <span class="badge badge-${org.tier}">${org.tier}</span>
                                <span class="badge badge-secondary">${org.industry}</span>
                                <span class="badge badge-secondary">${org.size}</span>
                            </div>
                        </div>
                        <div class="org-actions">
                            <button class="btn-icon" onclick="viewOrganizationDetails('${org.tenant_id}')" title="View Details">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn-icon" onclick="viewOrganizationUsage('${org.tenant_id}')" title="View Usage">
                                <i class="fas fa-chart-line"></i>
                            </button>
                        </div>
                    </div>
                    <div class="org-card-body">
                        <div class="org-stats">
                            <div class="org-stat">
                                <span class="org-stat-label">Total Queries</span>
                                <span class="org-stat-value">${org.usage?.total_queries?.toLocaleString() || '0'}</span>
                            </div>
                            <div class="org-stat">
                                <span class="org-stat-label">SLM Usage</span>
                                <span class="org-stat-value">${org.usage?.slm_percentage || 0}%</span>
                            </div>
                            <div class="org-stat">
                                <span class="org-stat-label">Total Cost</span>
                                <span class="org-stat-value">$${org.usage?.estimated_cost?.toFixed(2) || '0.00'}</span>
                            </div>
                            <div class="org-stat">
                                <span class="org-stat-label">Cost Savings</span>
                                <span class="org-stat-value text-success">${calculateSavings(org.usage?.slm_percentage || 0)}%</span>
                            </div>
                        </div>
                        <div class="org-progress">
                            <div class="progress-bar-container">
                                <div class="progress-bar">
                                    <div class="progress-fill slm-fill" style="width: ${org.usage?.slm_percentage || 0}%"></div>
                                    <div class="progress-fill llm-fill" style="width: ${100 - (org.usage?.slm_percentage || 0)}%"></div>
                                </div>
                                <div class="progress-labels">
                                    <span class="label-slm">SLM (${org.usage?.slm_percentage || 0}%)</span>
                                    <span class="label-llm">LLM (${100 - (org.usage?.slm_percentage || 0)}%)</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Update organization stats
        function updateOrganizationStats() {
            const totalOrgs = allOrganizations.length;
            const totalQueries = allOrganizations.reduce((sum, org) => sum + (org.usage?.total_queries || 0), 0);
            const totalCost = allOrganizations.reduce((sum, org) => sum + (org.usage?.estimated_cost || 0), 0);
            const avgSLM = allOrganizations.length > 0 
                ? allOrganizations.reduce((sum, org) => sum + (org.usage?.slm_percentage || 0), 0) / allOrganizations.length 
                : 0;

            document.getElementById('total-organizations').textContent = totalOrgs;
            document.getElementById('total-queries-all').textContent = totalQueries.toLocaleString();
            document.getElementById('total-cost-all').textContent = `$${totalCost.toFixed(2)}`;
            document.getElementById('avg-slm-usage').textContent = `${avgSLM.toFixed(1)}%`;
            
            // Also update dashboard cost analytics
            updateDashboardCostAnalytics();
        }

        // Get industry icon
        function getIndustryIcon(industry) {
            const icons = {
                finance: 'fa-university',
                healthcare: 'fa-heartbeat',
                tech: 'fa-laptop-code',
                retail: 'fa-shopping-cart',
                manufacturing: 'fa-industry',
                education: 'fa-graduation-cap',
                general: 'fa-briefcase'
            };
            return icons[industry] || 'fa-building';
        }

        // Calculate savings percentage
        function calculateSavings(slmPercentage) {
            // Rough estimate: SLM is ~15x cheaper than LLM
            // If 70% SLM usage, savings  60-65%
            return Math.round(slmPercentage * 0.85);
        }

        // View organization details
        function viewOrganizationDetails(tenantId) {
            const org = allOrganizations.find(o => o.tenant_id === tenantId);
            if (!org) return;

            showToast(`Viewing details for ${org.name}`, 'info');
            // In production, this would open a detailed modal
        }

        // View organization usage
        async function viewOrganizationUsage(tenantId) {
            const org = allOrganizations.find(o => o.tenant_id === tenantId);
            if (!org) return;

            try {
                const response = await fetch(`${API_BASE_URL}/api/v1/organizations/${tenantId}/usage`);
                if (response.ok) {
                    const usage = await response.json();
                    showToast(`Loading usage for ${org.name}...`, 'info');
                    console.log('Usage data:', usage);
                    // In production, display in a modal
                } else {
                    showToast(`Showing demo usage for ${org.name}`, 'info');
                }
            } catch (error) {
                console.error('Error loading usage:', error);
                showToast(`Showing demo usage for ${org.name}`, 'info');
            }
        }

        // Refresh organizations
        function refreshOrganizations() {
            showToast('Refreshing organizations...', 'info');
            loadOrganizations();
        }

        // Handle create organization form
        document.addEventListener('DOMContentLoaded', () => {
            const createOrgForm = document.getElementById('create-organization-form');
            if (createOrgForm) {
                createOrgForm.addEventListener('submit', async (e) => {
                    e.preventDefault();

                    const formData = new FormData(createOrgForm);
                    const orgData = {
                        organization_name: formData.get('organization_name'),
                        admin_name: formData.get('admin_name'),
                        admin_email: formData.get('admin_email'),
                        industry: formData.get('industry'),
                        size: formData.get('size'),
                        subscription_tier: formData.get('subscription_tier')
                    };

                    try {
                        const response = await fetch(`${API_BASE_URL}/api/v1/organizations`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(orgData)
                        });

                        if (response.ok) {
                            const result = await response.json();
                            showToast('Organization created successfully!', 'success');
                            loadOrganizations();
                            document.getElementById('create-organization-modal').style.display = 'none';
                            createOrgForm.reset();
                        } else {
                            const error = await response.json();
                            throw new Error(error.detail || 'Failed to create organization');
                        }
                    } catch (error) {
                        console.error('Error creating organization:', error);
                        
                        // Demo mode: Add locally
                        const newOrg = {
                            tenant_id: `tenant_${Date.now()}`,
                            name: orgData.organization_name,
                            industry: orgData.industry,
                            size: orgData.size,
                            tier: orgData.subscription_tier,
                            created_at: new Date().toISOString(),
                            usage: {
                                total_queries: 0,
                                slm_queries: 0,
                                llm_queries: 0,
                                slm_percentage: 0,
                                estimated_cost: 0
                            }
                        };

                        allOrganizations.push(newOrg);
                        renderOrganizations();
                        updateOrganizationStats();
                        
                        showToast('Organization created (demo mode)', 'success');
                        document.getElementById('create-organization-modal').style.display = 'none';
                        createOrgForm.reset();
                    }
                });
            }

            // Load organizations when tab is shown
            loadOrganizations();
        });

        // ===== DASHBOARD COST OPTIMIZATION =====
        
        // Update dashboard cost optimization analytics
        async function updateDashboardCostAnalytics() {
            try {
                // Try to fetch real data from API
                const response = await fetch(`${API_BASE_URL}/api/v1/routing/global-stats`);
                
                let stats;
                if (response.ok) {
                    stats = await response.json();
                } else {
                    // Use aggregated data from organizations
                    stats = calculateAggregatedStats();
                }

                // Update SLM/LLM query counts
                const slmQueries = stats.slm_queries || 0;
                const llmQueries = stats.llm_queries || 0;
                const totalQueries = slmQueries + llmQueries;
                
                const slmPercentage = totalQueries > 0 ? Math.round((slmQueries / totalQueries) * 100) : 0;
                const llmPercentage = totalQueries > 0 ? Math.round((llmQueries / totalQueries) * 100) : 0;

                document.getElementById('dashboard-slm-queries').textContent = slmQueries.toLocaleString();
                document.getElementById('dashboard-slm-percentage').textContent = `${slmPercentage}% of total`;
                
                document.getElementById('dashboard-llm-queries').textContent = llmQueries.toLocaleString();
                document.getElementById('dashboard-llm-percentage').textContent = `${llmPercentage}% of total`;

                // Calculate cost savings
                // Assuming: SLM cost = $0.01 per query, LLM cost = $0.15 per query
                const slmCost = slmQueries * 0.01;
                const llmCost = llmQueries * 0.15;
                const totalCost = slmCost + llmCost;
                
                // Calculate what it would have cost if all queries went to LLM
                const potentialCost = totalQueries * 0.15;
                const savings = potentialCost - totalCost;
                const savingsPercentage = potentialCost > 0 ? Math.round((savings / potentialCost) * 100) : 0;

                document.getElementById('dashboard-cost-savings').textContent = `$${savings.toFixed(2)}`;
                document.getElementById('dashboard-savings-percentage').textContent = `${savingsPercentage}% saved`;
                
                document.getElementById('dashboard-total-cost').textContent = `$${totalCost.toFixed(2)}`;

                // Update distribution bars
                document.getElementById('dashboard-slm-bar').style.width = `${slmPercentage}%`;
                document.getElementById('dashboard-slm-bar').querySelector('.distribution-value').textContent = `${slmPercentage}%`;
                
                document.getElementById('dashboard-llm-bar').style.width = `${llmPercentage}%`;
                document.getElementById('dashboard-llm-bar').querySelector('.distribution-value').textContent = `${llmPercentage}%`;

            } catch (error) {
                console.error('Error updating dashboard cost analytics:', error);
                // Use demo data
                updateDashboardWithDemoData();
            }
        }

        // Calculate aggregated stats from organizations
        function calculateAggregatedStats() {
            if (!allOrganizations || allOrganizations.length === 0) {
                return { slm_queries: 0, llm_queries: 0 };
            }

            return allOrganizations.reduce((acc, org) => {
                const usage = org.usage || {};
                acc.slm_queries += usage.slm_queries || 0;
                acc.llm_queries += usage.llm_queries || 0;
                return acc;
            }, { slm_queries: 0, llm_queries: 0 });
        }

        // Update with demo data
        function updateDashboardWithDemoData() {
            const demoStats = {
                slm_queries: 28554,
                llm_queries: 10986
            };

            const totalQueries = demoStats.slm_queries + demoStats.llm_queries;
            const slmPercentage = Math.round((demoStats.slm_queries / totalQueries) * 100);
            const llmPercentage = Math.round((demoStats.llm_queries / totalQueries) * 100);

            document.getElementById('dashboard-slm-queries').textContent = demoStats.slm_queries.toLocaleString();
            document.getElementById('dashboard-slm-percentage').textContent = `${slmPercentage}% of total`;
            
            document.getElementById('dashboard-llm-queries').textContent = demoStats.llm_queries.toLocaleString();
            document.getElementById('dashboard-llm-percentage').textContent = `${llmPercentage}% of total`;

            const slmCost = demoStats.slm_queries * 0.01;
            const llmCost = demoStats.llm_queries * 0.15;
            const totalCost = slmCost + llmCost;
            const potentialCost = totalQueries * 0.15;
            const savings = potentialCost - totalCost;
            const savingsPercentage = Math.round((savings / potentialCost) * 100);

            document.getElementById('dashboard-cost-savings').textContent = `$${savings.toFixed(2)}`;
            document.getElementById('dashboard-savings-percentage').textContent = `${savingsPercentage}% saved`;
            document.getElementById('dashboard-total-cost').textContent = `$${totalCost.toFixed(2)}`;

            document.getElementById('dashboard-slm-bar').style.width = `${slmPercentage}%`;
            document.getElementById('dashboard-slm-bar').querySelector('.distribution-value').textContent = `${slmPercentage}%`;
            
            document.getElementById('dashboard-llm-bar').style.width = `${llmPercentage}%`;
            document.getElementById('dashboard-llm-bar').querySelector('.distribution-value').textContent = `${llmPercentage}%`;
        }
    </script>
    <style>
        /* Organization Management Styles */
        .organizations-management {
            padding: 2rem;
        }

        .organizations-list {
            background: white;
            border-radius: 1rem;
            padding: 1.5rem;
            box-shadow: var(--shadow-sm);
        }

        .list-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--border-color);
        }

        .list-header h3 {
            font-size: 1.25rem;
            color: var(--text-primary);
            margin: 0;
        }

        .search-bar {
            position: relative;
            width: 300px;
        }

        .search-bar i {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
        }

        .search-bar input {
            width: 100%;
            padding: 0.75rem 1rem 0.75rem 2.5rem;
            border: 2px solid var(--border-color);
            border-radius: 0.5rem;
            font-size: 0.875rem;
            transition: all 0.3s ease;
        }

        .search-bar input:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .organization-card {
            background: white;
            border: 2px solid var(--border-color);
            border-radius: 1rem;
            margin-bottom: 1.5rem;
            transition: all 0.3s ease;
        }

        .organization-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
            border-color: var(--primary-color);
        }

        .org-card-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1.5rem;
            border-bottom: 2px solid var(--border-color);
        }

        .org-icon {
            width: 3.5rem;
            height: 3.5rem;
            border-radius: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            flex-shrink: 0;
        }

        .org-icon.finance {
            background: linear-gradient(135deg, #3b82f6, #1e40af);
            color: white;
        }

        .org-icon.healthcare {
            background: linear-gradient(135deg, #ef4444, #b91c1c);
            color: white;
        }

        .org-icon.tech {
            background: linear-gradient(135deg, #8b5cf6, #6d28d9);
            color: white;
        }

        .org-icon.retail {
            background: linear-gradient(135deg, #10b981, #047857);
            color: white;
        }

        .org-icon.general {
            background: linear-gradient(135deg, #64748b, #475569);
            color: white;
        }

        .org-info {
            flex: 1;
        }

        .org-info h3 {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
            margin: 0 0 0.5rem 0;
        }

        .org-meta {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .badge {
            padding: 0.25rem 0.75rem;
            border-radius: 0.375rem;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.025em;
        }

        .badge-basic {
            background: #dbeafe;
            color: #1e40af;
        }

        .badge-professional {
            background: #dcfce7;
            color: #166534;
        }

        .badge-enterprise {
            background: #fef3c7;
            color: #92400e;
        }

        .badge-secondary {
            background: #f1f5f9;
            color: #475569;
        }

        .org-actions {
            display: flex;
            gap: 0.5rem;
        }

        .btn-icon {
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 0.5rem;
            border: 2px solid var(--border-color);
            background: white;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-icon:hover {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .org-card-body {
            padding: 1.5rem;
        }

        .org-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .org-stat {
            text-align: center;
        }

        .org-stat-label {
            display: block;
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .org-stat-value {
            display: block;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .text-success {
            color: var(--success-color);
        }

        .org-progress {
            margin-top: 1rem;
        }

        .progress-bar-container {
            margin-top: 1rem;
        }

        .progress-bar {
            height: 2rem;
            background: #f1f5f9;
            border-radius: 0.5rem;
            overflow: hidden;
            display: flex;
            margin-bottom: 0.5rem;
        }

        .progress-fill {
            height: 100%;
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .slm-fill {
            background: linear-gradient(90deg, #10b981, #059669);
        }

        .llm-fill {
            background: linear-gradient(90deg, #3b82f6, #2563eb);
        }

        .progress-labels {
            display: flex;
            justify-content: space-between;
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .label-slm {
            color: #059669;
            font-weight: 600;
        }

        .label-llm {
            color: #2563eb;
            font-weight: 600;
        }

        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
        }

        .empty-state i {
            font-size: 4rem;
            color: var(--text-secondary);
            opacity: 0.3;
            margin-bottom: 1rem;
        }

        .empty-state h3 {
            font-size: 1.5rem;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .empty-state p {
            color: var(--text-secondary);
            margin-bottom: 1.5rem;
        }

        /* Cost Optimization Analytics Styles */
        .cost-overview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .cost-stat-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border-radius: 1rem;
            padding: 1.5rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            border: 2px solid var(--border-color);
            transition: all 0.3s ease;
        }

        .cost-stat-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
            border-color: var(--primary-color);
        }

        .cost-stat-icon {
            width: 3.5rem;
            height: 3.5rem;
            border-radius: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
            flex-shrink: 0;
        }

        .cost-stat-icon.blue {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
        }

        .cost-stat-icon.purple {
            background: linear-gradient(135deg, #8b5cf6 0%, #6d28d9 100%);
        }

        .cost-stat-icon.green {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }

        .cost-stat-icon.orange {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        }

        .cost-stat-content {
            flex: 1;
        }

        .cost-stat-label {
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-bottom: 0.25rem;
            font-weight: 500;
        }

        .cost-stat-value {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }

        .cost-stat-subtitle {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        .model-distribution {
            background: linear-gradient(135deg, #f8fafc 0%, #ffffff 100%);
            border-radius: 1rem;
            padding: 2rem;
            border: 2px solid var(--border-color);
        }

        .model-distribution h4 {
            font-size: 1.125rem;
            color: var(--text-primary);
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .distribution-bars {
            margin-bottom: 2rem;
        }

        .distribution-row {
            margin-bottom: 1.5rem;
        }

        .distribution-label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--text-primary);
        }

        .distribution-label i {
            width: 1.25rem;
            text-align: center;
        }

        .distribution-bar {
            background: #e2e8f0;
            border-radius: 0.5rem;
            height: 2.5rem;
            position: relative;
            overflow: hidden;
        }

        .distribution-fill {
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 1rem;
            transition: width 0.5s ease;
            position: relative;
        }

        .distribution-fill.slm {
            background: linear-gradient(90deg, #10b981 0%, #059669 100%);
        }

        .distribution-fill.llm {
            background: linear-gradient(90deg, #3b82f6 0%, #2563eb 100%);
        }

        .distribution-value {
            color: white;
            font-weight: 600;
            font-size: 0.875rem;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
        }

        .cost-insights {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            padding: 1.5rem;
            background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
            border-radius: 0.75rem;
            border: 1px solid #93c5fd;
        }

        .insight-item {
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
            font-size: 0.875rem;
            color: #1e40af;
        }

        .insight-item i {
            margin-top: 0.125rem;
            flex-shrink: 0;
        }

        /* Tickets Management Styles */
        .tickets-management {
            padding: 2rem;
        }

        .ticket-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: white;
            border-radius: 1rem;
            padding: 1.5rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            border: 2px solid var(--border-color);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .stat-card.stat-active {
            border-color: #3b82f6;
        }

        .stat-card.stat-progress {
            border-color: #f59e0b;
        }

        .stat-card.stat-resolved {
            border-color: #10b981;
        }

        .stat-card.stat-inactive {
            border-color: #94a3b8;
        }

        .stat-icon {
            width: 3rem;
            height: 3rem;
            border-radius: 0.75rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .stat-active .stat-icon {
            background: #eff6ff;
            color: #3b82f6;
        }

        .stat-progress .stat-icon {
            background: #fef3c7;
            color: #f59e0b;
        }

        .stat-resolved .stat-icon {
            background: #d1fae5;
            color: #10b981;
        }

        .stat-inactive .stat-icon {
            background: #f1f5f9;
            color: #94a3b8;
        }

        .stat-info {
            flex: 1;
        }

        .stat-label {
            font-size: 0.875rem;
            color: var(--text-secondary);
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-top: 0.25rem;
        }

        .ticket-filters {
            background: white;
            border-radius: 1rem;
            padding: 1.5rem;
            border: 2px solid var(--border-color);
            margin-bottom: 1.5rem;
            display: flex;
            gap: 1.5rem;
            flex-wrap: wrap;
            align-items: center;
        }

        .filter-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .filter-group label {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--text-secondary);
        }

        .filter-group select,
        .filter-group input[type="text"] {
            padding: 0.5rem 1rem;
            border: 2px solid var(--border-color);
            border-radius: 0.5rem;
            font-size: 0.875rem;
            background: white;
            transition: all 0.2s ease;
        }

        .filter-group select:focus,
        .filter-group input[type="text"]:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .filter-group input[type="text"] {
            min-width: 200px;
        }

        .tickets-list {
            background: white;
            border-radius: 1rem;
            border: 2px solid var(--border-color);
            overflow: hidden;
        }

        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            color: var(--text-secondary);
        }

        .empty-state i {
            font-size: 4rem;
            opacity: 0.3;
            margin-bottom: 1rem;
        }

        .empty-state p {
            font-size: 1.125rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .empty-state small {
            font-size: 0.875rem;
        }

        .ticket-item {
            border-bottom: 1px solid var(--border-color);
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .ticket-item:last-child {
            border-bottom: none;
        }

        .ticket-item:hover {
            background: var(--background-color);
        }

        .ticket-item.expanded {
            background: var(--background-color);
        }

        .ticket-item-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem 1.5rem;
            user-select: none;
        }

        .ticket-indicator {
            width: 4px;
            height: 48px;
            border-radius: 2px;
            flex-shrink: 0;
        }

        .ticket-indicator.active {
            background: linear-gradient(180deg, #3b82f6, #2563eb);
        }

        .ticket-indicator.in_progress {
            background: linear-gradient(180deg, #f59e0b, #d97706);
        }

        .ticket-indicator.resolved {
            background: linear-gradient(180deg, #10b981, #059669);
        }

        .ticket-indicator.inactive {
            background: linear-gradient(180deg, #94a3b8, #64748b);
        }

        .ticket-icon {
            width: 48px;
            height: 48px;
            border-radius: 0.75rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            flex-shrink: 0;
            background: var(--background-color);
            border: 2px solid var(--border-color);
        }

        .ticket-icon.active {
            color: #3b82f6;
            border-color: #3b82f6;
            background: #eff6ff;
        }

        .ticket-icon.in_progress {
            color: #f59e0b;
            border-color: #f59e0b;
            background: #fef3c7;
        }

        .ticket-icon.resolved {
            color: #10b981;
            border-color: #10b981;
            background: #d1fae5;
        }

        .ticket-icon.inactive {
            color: #94a3b8;
            border-color: #94a3b8;
            background: #f1f5f9;
        }

        .ticket-summary {
            flex: 1;
            min-width: 0;
        }

        .ticket-title-row {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 0.5rem;
        }

        .ticket-title {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 1rem;
        }

        .ticket-id {
            font-size: 0.75rem;
            color: var(--text-secondary);
            font-weight: 500;
            font-family: 'Courier New', monospace;
        }

        .ticket-priority-badge {
            padding: 0.25rem 0.5rem;
            border-radius: 0.375rem;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .ticket-priority-badge.critical {
            background: #fee2e2;
            color: #dc2626;
        }

        .ticket-priority-badge.high {
            background: #fed7aa;
            color: #ea580c;
        }

        .ticket-priority-badge.medium {
            background: #fef3c7;
            color: #d97706;
        }

        .ticket-priority-badge.low {
            background: #dbeafe;
            color: #2563eb;
        }

        .ticket-meta {
            display: flex;
            align-items: center;
            gap: 1.5rem;
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .ticket-meta-item {
            display: flex;
            align-items: center;
            gap: 0.375rem;
        }

        .ticket-meta-item i {
            font-size: 0.75rem;
        }

        .ticket-expand-icon {
            margin-left: auto;
            color: var(--text-secondary);
            transition: transform 0.2s ease;
        }

        .ticket-item.expanded .ticket-expand-icon {
            transform: rotate(180deg);
        }

        .ticket-details {
            display: none;
            padding: 1.5rem;
            border-top: 1px solid var(--border-color);
            background: white;
        }

        .ticket-item.expanded .ticket-details {
            display: block;
        }

        .ticket-description {
            margin-bottom: 1.5rem;
        }

        .ticket-description h4 {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .ticket-description p {
            color: var(--text-primary);
            line-height: 1.6;
        }

        .ticket-actions {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
        }

        .ticket-action-btn {
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            font-weight: 500;
            border: 2px solid var(--border-color);
            background: white;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .ticket-action-btn:hover {
            background: var(--background-color);
            border-color: var(--primary-color);
            color: var(--primary-color);
        }

        .ticket-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .ticket-tag {
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.75rem;
            font-weight: 500;
            background: var(--background-color);
            color: var(--text-secondary);
            border: 1px solid var(--border-color);
        }

        /* Data Archives Styles */
        .archives-management {
            padding: 2rem;
        }

        .archive-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .archive-filters {
            background: white;
            border-radius: 1rem;
            padding: 1.5rem;
            border: 2px solid var(--border-color);
            margin-bottom: 1.5rem;
            display: flex;
            gap: 1.5rem;
            flex-wrap: wrap;
            align-items: center;
        }

        .archives-list {
            background: white;
            border-radius: 1rem;
            border: 2px solid var(--border-color);
            overflow: hidden;
        }

        .archive-item {
            border-bottom: 1px solid var(--border-color);
            padding: 1.5rem;
            transition: all 0.2s ease;
        }

        .archive-item:last-child {
            border-bottom: none;
        }

        .archive-item:hover {
            background: var(--background-color);
        }

        .archive-item-header {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
        }

        .archive-indicator {
            width: 4px;
            height: 100%;
            min-height: 60px;
            border-radius: 2px;
            flex-shrink: 0;
        }

        .archive-icon {
            width: 48px;
            height: 48px;
            border-radius: 0.75rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            flex-shrink: 0;
            border: 2px solid;
        }

        .archive-summary {
            flex: 1;
            min-width: 0;
        }

        .archive-title-row {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 0.75rem;
            flex-wrap: wrap;
        }

        .archive-title {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 1.125rem;
        }

        .archive-id {
            font-size: 0.75rem;
            color: var(--text-secondary);
            font-weight: 500;
            font-family: 'Courier New', monospace;
        }

        .archive-category-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 0.375rem;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .archive-meta {
            display: flex;
            align-items: center;
            gap: 1.5rem;
            font-size: 0.875rem;
            color: var(--text-secondary);
            flex-wrap: wrap;
            margin-bottom: 0.75rem;
        }

        .archive-meta-item {
            display: flex;
            align-items: center;
            gap: 0.375rem;
        }

        .archive-meta-item i {
            font-size: 0.75rem;
        }

        .archive-description {
            color: var(--text-secondary);
            font-size: 0.875rem;
            line-height: 1.5;
            margin-bottom: 0.75rem;
        }

        .archive-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .archive-tag {
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.75rem;
            font-weight: 500;
            background: var(--background-color);
            color: var(--text-secondary);
            border: 1px solid var(--border-color);
        }

        .archive-actions {
            display: flex;
            gap: 0.75rem;
            margin-top: 1rem;
            flex-wrap: wrap;
        }

        .archive-action-btn {
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            font-weight: 500;
            border: 2px solid var(--border-color);
            background: white;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .archive-action-btn:hover {
            background: var(--background-color);
            border-color: var(--primary-color);
            color: var(--primary-color);
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
            font-weight: 500;
        }

        .checkbox-label input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        /* Additional styles for toast notifications */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10000;
        }
        
        .toast {
            background: white;
            padding: 1rem 1.5rem;
            border-radius: 0.5rem;
            box-shadow: var(--shadow-lg);
            margin-bottom: 0.5rem;
            border-left: 4px solid var(--primary-color);
            animation: slideIn 0.3s ease;
        }
        
        .toast-info { border-left-color: var(--primary-color); }
        .toast-success { border-left-color: var(--success-color); }
        .toast-warning { border-left-color: var(--warning-color); }
        .toast-error { border-left-color: var(--error-color); }
        
        .toast-content {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        /* Modal styles */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(4px);
            z-index: 9999;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.2s ease;
        }
        
        .modal {
            background: white;
            border-radius: 1.5rem;
            max-width: 700px;
            width: 90%;
            max-height: 90vh;
            overflow: hidden;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25);
            animation: slideUp 0.3s ease;
        }
        
        @keyframes slideUp {
            from {
                transform: translateY(20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        .modal-header {
            padding: 2rem 2rem 1.5rem;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(to bottom, #f8fafc, white);
        }
        
        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #0f172a;
            letter-spacing: -0.01em;
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 1.75rem;
            cursor: pointer;
            color: #64748b;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 0.5rem;
            transition: all 0.2s;
        }
        
        .modal-close:hover {
            background: #f1f5f9;
            color: #0f172a;
        }
        
        .modal-content {
            padding: 2rem;
            max-height: calc(90vh - 140px);
            overflow-y: auto;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .form-group.full-width {
            grid-column: 1 / -1;
        }
        
        .form-group label {
            font-weight: 600;
            color: #0f172a;
            font-size: 0.875rem;
            margin-bottom: 0.25rem;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 0.875rem 1rem;
            border: 2px solid #e2e8f0;
            border-radius: 0.75rem;
            font-size: 0.875rem;
            font-family: inherit;
            transition: all 0.2s;
            background: white;
        }
        
        .form-group input[type="file"] {
            padding: 0.5rem;
            cursor: pointer;
            border: 2px dashed #cbd5e1;
            background: #f8fafc;
        }
        
        .form-group input[type="file"]:hover {
            border-color: #667eea;
            background: #f0f4ff;
        }
        
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #2563eb;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }
        
        .form-group textarea {
            resize: vertical;
            min-height: 100px;
            line-height: 1.6;
        }
        
        .form-actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            margin-top: 2rem;
            padding-top: 1.5rem;
            border-top: 1px solid #e2e8f0;
        }
        
        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 0.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn-primary {
            background: var(--primary-color);
            color: white;
        }
        
        .btn-primary:hover {
            background: var(--primary-dark);
        }
        
        .btn-outline {
            background: transparent;
            border: 1px solid var(--border-color);
            color: var(--text-primary);
        }
        
        .btn-outline:hover {
            background: var(--background-color);
        }
        
        .btn-sm {
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
        }
    </style>
</body>
</html>